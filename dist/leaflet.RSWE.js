/*
	Leaflet.RSWE, Room Sketches Web Editor, a plugin that adds ability to draw and edit rooms and indoo sketches to Leaflet powered maps.
	(c) 2016, Alexey Soloviev
	https://github.com/Leaflet/Leaflet.RSWE
	http://leafletjs.com
	https://github.com/syas
*/
!function(t,e,i){!function(){L.Map.addInitHook(function(){var t=this;t.options.zoomControl||(this.zoomControl=new L.Control.Zoom({position:"bottomright"}),this.addControl(this.zoomControl))}),L.Control.FullScreen=L.Control.extend({options:{position:"bottomright",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(t){var e,i="leaflet-control-zoom-fullscreen",o="";return e=t.zoomControl&&!this.options.forceSeparateButton?t.zoomControl._container:L.DomUtil.create("div","leaflet-bar"),this.options.content?o=this.options.content:i+=" fullscreen-icon",this._createButton(this.options.title,i,o,e,this.toggleFullScreen,this),this._map.on("enterFullscreen exitFullscreen",this._toggleTitle,this),e},_createButton:function(t,o,n,a,s,r){return this.link=L.DomUtil.create("a",o,a),this.link.href="#",this.link.title=t,this.link.innerHTML=n,L.DomEvent.addListener(this.link,"click",L.DomEvent.stopPropagation).addListener(this.link,"click",L.DomEvent.preventDefault).addListener(this.link,"click",s,r),L.DomEvent.addListener(a,i.fullScreenEventName,L.DomEvent.stopPropagation).addListener(a,i.fullScreenEventName,L.DomEvent.preventDefault).addListener(a,i.fullScreenEventName,this._handleEscKey,r),L.DomEvent.addListener(e,i.fullScreenEventName,L.DomEvent.stopPropagation).addListener(e,i.fullScreenEventName,L.DomEvent.preventDefault).addListener(e,i.fullScreenEventName,this._handleEscKey,r),this.link},toggleFullScreen:function(){var t=this._map;t._exitFired=!1,t._isFullscreen?(i.supportsFullScreen&&!this.options.forcePseudoFullscreen?i.cancelFullScreen(t._container):L.DomUtil.removeClass(t._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(t.invalidateSize,t),200),t.fire("exitFullscreen"),t._exitFired=!0,t._isFullscreen=!1):(i.supportsFullScreen&&!this.options.forcePseudoFullscreen?i.requestFullScreen(t._container):L.DomUtil.addClass(t._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(t.invalidateSize,t),200),t.fire("enterFullscreen"),t._isFullscreen=!0)},_toggleTitle:function(){this.link.title=this._map._isFullscreen?this.options.title:this.options.titleCancel},_handleEscKey:function(){var t=this._map;i.isFullScreen(t)||t._exitFired||(t.fire("exitFullscreen"),t._exitFired=!0,t._isFullscreen=!1)}}),L.control.fullscreen=function(t){return new L.Control.FullScreen(t)},L.Map.addInitHook(function(){L.extend(this.options,{fullscreenControl:!0}),this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))});var i={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},o="webkit moz o ms khtml".split(" ");if("undefined"!=typeof e.exitFullscreen)i.supportsFullScreen=!0;else for(var n=0,a=o.length;a>n;n++)if(i.prefix=o[n],"undefined"!=typeof e[i.prefix+"CancelFullScreen"]){i.supportsFullScreen=!0;break}i.supportsFullScreen&&(i.fullScreenEventName=i.prefix+"fullscreenchange",i.isFullScreen=function(){switch(this.prefix){case"":return e.fullScreen;case"webkit":return e.webkitIsFullScreen;default:return e[this.prefix+"FullScreen"]}},i.requestFullScreen=function(t){return""===this.prefix?t.requestFullscreen():t[this.prefix+"RequestFullScreen"]()},i.cancelFullScreen=function(){return""===this.prefix?e.exitFullscreen():e[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var t=jQuery(this);i.supportsFullScreen&&i.requestFullScreen(t)})}),t.fullScreenApi=i}(),L.Util=L.extend(L.Util||{},{base64KeyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64Encode:function(t){var e,i,o,n,a,s,r,l="",h=0;for(t=this.base64Utf8Encode(t);h<t.length;)e=t.charCodeAt(h++),i=t.charCodeAt(h++),o=t.charCodeAt(h++),n=e>>2,a=(3&e)<<4|i>>4,s=(15&i)<<2|o>>6,r=63&o,isNaN(i)?s=r=64:isNaN(o)&&(r=64),l=l+this.base64KeyStr.charAt(n)+this.base64KeyStr.charAt(a)+this.base64KeyStr.charAt(s)+this.base64KeyStr.charAt(r);return l},base64Decode:function(t){var e,i,o,n,a,s,r,l="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)n=this.base64KeyStr.indexOf(t.charAt(h++)),a=this.base64KeyStr.indexOf(t.charAt(h++)),s=this.base64KeyStr.indexOf(t.charAt(h++)),r=this.base64KeyStr.indexOf(t.charAt(h++)),e=n<<2|a>>4,i=(15&a)<<4|s>>2,o=(3&s)<<6|r,l+=String.fromCharCode(e),64!==s&&(l+=String.fromCharCode(i)),64!==r&&(l+=String.fromCharCode(o));return l=this.base64Utf8Decode(l)},base64Utf8Encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var o=t.charCodeAt(i);128>o?e+=String.fromCharCode(o):o>127&&2048>o?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e},base64Utf8Decode:function(t){for(var e="",i=0,o=0,n=0,a=0;i<t.length;)o=t.charCodeAt(i),128>o?(e+=String.fromCharCode(o),i++):o>191&&224>o?(n=t.charCodeAt(i+1),e+=String.fromCharCode((31&o)<<6|63&n),i+=2):(n=t.charCodeAt(i+1),a=t.charCodeAt(i+2),e+=String.fromCharCode((15&o)<<12|(63&n)<<6|63&a),i+=3);return e}}),L.Curve=L.Path.extend({options:{},initialize:function(t,e){L.setOptions(this,e),this._setPath(t)},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,e,i,o,n,a,s,r,l,h=new L.LatLngBounds,p=0;p<this._coords.length;p++)i=this._coords[p],"string"==typeof i||i instanceof String?e=i:"H"===e?(h.extend([t.lat,i[0]]),t=new L.latLng(t.lat,i[0])):"V"===e?(h.extend([i[0],t.lng]),t=new L.latLng(i[0],t.lng)):"C"===e?(n=new L.latLng(i[0],i[1]),i=this._coords[++p],a=new L.latLng(i[0],i[1]),i=this._coords[++p],s=new L.latLng(i[0],i[1]),h.extend(n),h.extend(a),h.extend(s),s.controlPoint1=n,s.controlPoint2=a,t=s):"S"===e?(a=new L.latLng(i[0],i[1]),i=this._coords[++p],s=new L.latLng(i[0],i[1]),n=t,t.controlPoint2&&(r=t.lat-t.controlPoint2.lat,l=t.lng-t.controlPoint2.lng,n=new L.latLng(t.lat+r,t.lng+l)),h.extend(n),h.extend(a),h.extend(s),s.controlPoint1=n,s.controlPoint2=a,t=s):"Q"===e?(o=new L.latLng(i[0],i[1]),i=this._coords[++p],s=new L.latLng(i[0],i[1]),h.extend(o),h.extend(s),s.controlPoint=o,t=s):"T"===e?(s=new L.latLng(i[0],i[1]),o=t,t.controlPoint&&(r=t.lat-t.controlPoint.lat,l=t.lng-t.controlPoint.lng,o=new L.latLng(t.lat+r,t.lng+l)),h.extend(o),h.extend(s),s.controlPoint=o,t=s):(h.extend(i),t=new L.latLng(i[0],i[1]));return h},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_project:function(){var t,e,i,o;this._points=[];for(var n=0;n<this._coords.length;n++)if(t=this._coords[n],"string"==typeof t||t instanceof String)this._points.push(t),i=t;else{switch(t.length){case 2:o=this._map.latLngToLayerPoint(t),e=t;break;case 1:"H"===i?(o=this._map.latLngToLayerPoint([e[0],t[0]]),e=[e[0],t[0]]):(o=this._map.latLngToLayerPoint([t[0],e[1]]),e=[t[0],e[1]])}this._points.push(o)}},getPathString:function(){return this._project(),this._curvePointsToPath(this._points)},_curvePointsToPath:function(t){var e,i,o="";if(t)for(var n=0;n<t.length;n++)if(e=t[n],"string"==typeof e||e instanceof String)i=e,o+=i;else switch(i){case"H":o+=e.x+" ";break;case"V":o+=e.y+" ";break;default:o+=e.x+" "+e.y+" "}return o||"M0 0"}}),L.curve=function(t,e){return new L.Curve(t,e)},L.ScalableText=L.Path.extend({includes:L.Mixin.Events,initialize:function(t,e,o,n){var a;n&&n.attributes&&(a={},L.Util.extend(a,n.attributes),delete n.attributes),this.options={},L.Util.extend(this.options,this.defaultOptions),n&&L.Util.extend(this.options,n),this.options.attributes={},L.Util.extend(this.options.attributes,this.defaultAttributes),a!==i&&(L.Util.extend(this.options.attributes,a),n.attributes={},L.Util.extend(n.attributes,a)),L.Path.prototype.initialize.call(this,this.options),this._latlngs=this._convertLatLngs([e,o]),this._text=t},defaultAttributes:{fill:"white","text-anchor":"start","line-height":"15px","font-size":"12px","font-family":"Arial"},defaultOptions:{editable:!1,clickable:!0,bgColor:"black",orientation:"normal",center:!0,below:!1},options:{},onAdd:function(t){L.Path.prototype.onAdd.call(this,t),this._map=t,this._textRedraw()},onRemove:function(t){t=t||this._map,t&&this._gNode&&this._textNode&&this._rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),delete this._textNode,delete this._rectNode),t&&this._container&&(this._container.removeChild(this._gNode),delete this._gNode),L.Path.prototype.onRemove.call(this,t)},bringToFront:function(){this._map&&(L.Path.prototype.bringToFront.call(this,this._map),this._textRedraw())},bringToBack:function(){this._map&&(L.Path.prototype.bringToBack.call(this,this._map),this._textRedraw())},_updatePath:function(){this._map&&(L.Path.prototype._updatePath.call(this),this._textRedraw())},redraw:function(){this._map&&(L.Path.prototype.redraw.call(this),this._textRedraw())},_textRedraw:function(){var t=this._text;t&&this.setText(t)},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getLatLngs:function(){return this._latlngs},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,o,n=e?t:[];for(i=0,o=t.length;o>i;i++){if(L.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;n[i]=L.latLng(t[i])}return n},_initEvents:function(){L.Path.prototype._initEvents.call(this)},setText:function(t){if(this._text=t,!L.Browser.svg||"undefined"==typeof this._map)return this;if(!this._text)return this._map&&this._container&&this._gNode&&this._textNode&&this.rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),delete this._textNode,delete this._rectNode),this._container&&this._gNode&&(this._container.removeChild(this._gNode),delete this._gNode),this;this._gNode||(this._gNode=L.Path.prototype._createElement("g"),this._rectNode||(this._rectNode=L.Path.prototype._createElement("rect"),this._gNode.appendChild(this._rectNode)),this._textNode||(this._textNode=L.Path.prototype._createElement("text"),this._gNode.appendChild(this._textNode)),this._container.appendChild(this._gNode),!L.Browser.svg&&L.Browser.vml||!this.options.clickable||this._gNode.setAttribute("class","leaflet-clickable"));for(var e in this.options.attributes)this._textNode.setAttribute(e,this.options.attributes[e]);if(this._textNode.innerHTML=this._text.replace(/ /g,"Â "),this._latlngs[1]&&this._latlngs[0]){var i=parseInt(this.options.attributes["line-height"].replace("px",""),10),o=parseInt(this.options.attributes["font-size"].replace("px",""),10),n=this._map.latLngToLayerPoint(this._latlngs[0]),a=n.distanceTo(this._map.latLngToLayerPoint(this._latlngs[1]))/i,s=Math.cos(this._latlngs[0].lat*Math.PI/180),r=180*Math.atan2(-this._latlngs[0].lat+this._latlngs[1].lat,(this._latlngs[0].lng-this._latlngs[1].lng)*s)/Math.PI-90,l="translate("+n.x+" "+n.y+") scale("+a+") rotate("+r+")";this.options.center&&(l=l+" translate("+-.5*this._textNode.getComputedTextLength()+")"),this._textNode.setAttribute("x","0"),this._textNode.setAttribute("y","-"+.8*(i-o)),this._rectNode.setAttribute("x","0"),this._rectNode.setAttribute("y","-"+i),this._rectNode.setAttribute("height",""+i),this._rectNode.setAttribute("width",this._textNode.getComputedTextLength()),this._rectNode.setAttribute("fill",this.options.bgColor),this._rectNode.setAttribute("transform",l),this._textNode.setAttribute("transform",l),n=null}return this}}),L.Edit=L.Edit||{},L.Edit.ScalableText=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._scalabletext=t,L.setOptions(this,e)},addHooks:function(){var t=this._scalabletext;t.setStyle(t.options.editing),this._scalabletext.options.editable&&this._scalabletext._map&&(this._markerGroup||this._initMarkers(),this._scalabletext._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._scalabletext;t.setStyle(t.options.original),this._scalabletext.options.editable&&this._scalabletext._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e=this._scalabletext._latlngs;this._scalabletext.options.markerOnTop?(t=this._createMarker(e[1],1),this._markers.push(t)):(t=this._createMarker(e[0],0),this._markers.push(t))},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(i),i},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._scalabletext.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._scalabletext.edited=!0,this._scalabletext.fire("edit"),this._scalabletext._map.fire("edit",{layer:this._scalabletext})},_onMarkerDrag:function(t){var e=t.target;L.DomEvent.preventDefault(t);var i={lat:e._latlng.lat-e._origLatLng.lat,lng:e._latlng.lng-e._origLatLng.lng};this._scalabletext.options.editable&&this._scalabletext.options.onDrag&&this._scalabletext.options.onDrag.call(this,e,i),this._scalabletext.options.markerOnTop?(this._scalabletext._latlngs[0].lat+=e._latlng.lat-e._origLatLng.lat,this._scalabletext._latlngs[0].lng+=e._latlng.lng-e._origLatLng.lng):(this._scalabletext._latlngs[1].lat+=e._latlng.lat-e._origLatLng.lat,this._scalabletext._latlngs[1].lng+=e._latlng.lng-e._origLatLng.lng),L.extend(e._origLatLng,e._latlng),this._scalabletext.redraw()},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})}}),L.ScalableText.addInitHook(function(){this.editing||(L.Edit.ScalableText&&(this.editing=new L.Edit.ScalableText(this)),this.on("add",function(){this.editing&&this.editing.enabled()&&this.options.editable&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.options.editable&&this.editing.removeHooks()}))}),L.drawVersion="0.2.4-dev",L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",wall:"Draw a wall",window:"Draw a window",door:"Draw a door"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},wall:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing wall.",cont:"Click to continue drawing wall.",end:"Click last point to finish wall."}},window:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing window.",cont:"Click to continue drawing window.",end:"Click last point to finish window."}},door:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing door.",cont:"Click to continue drawing door.",end:"Click last point to finish door."}}}},edit:{toolbar:{actions:{save:{title:"Apply changes.",text:"Apply"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type,layer:this}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type,layer:this}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){this._map=t,this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-div-icon leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40],draggable:!0}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.addTo(this._map),this._map.on("zoomend",this._onZoomEnd,this),L.DomEvent.addListener(this._map._container,"mousedown",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"mousemove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"mouseup",this._onMouseUp,this),L.DomEvent.addListener(this._map._container,"touchstart",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onMouseUp,this),this._map.dragging&&this._map.dragging.disable())},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("zoomend",this._onZoomEnd,this),L.DomEvent.removeListener(this._map._container,"mousedown",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"mousemove",this._onMouseMove),L.DomEvent.removeListener(this._map._container,"mouseup",this._onMouseUp),L.DomEvent.removeListener(this._map._container,"touchstart",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"touchmove",this._onMouseMove),L.DomEvent.removeListener(this._map._container,"touchend",this._onMouseUp),this._map.dragging&&this._map.dragging.enable()},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._markers.length;return e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?void this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),void this._vertexChanged(t,!0))},_onMarkerMouseUp:function(t){t.preventDefault(),this._finishShape()},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);return!this.options.allowIntersection&&t||!this._shapeIsValid()?void this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){t.preventDefault(),t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.lastTouch=t.originalEvent.touches[0],this.startTouch=this.lastTouch),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint);var e=t.layerPoint,i=t.latlng;this._currentLatLng=i,t.originalEvent.touches||this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i)},_vertexChanged:function(t,e){this._updateStartHandler(),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){t.preventDefault(),t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint);var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY),this._latlngOrigin=t.latlng},_onMouseUp:function(e){if(e.preventDefault(),e.originalEvent=e.originalEvent?e.originalEvent:e,e.originalEvent.touches&&(e.originalEvent.clientX=e.originalEvent.clientX?e.originalEvent.clientX:this.lastTouch.clientX,e.originalEvent.clientY=e.originalEvent.clientY?e.originalEvent.clientY:this.lastTouch.clientY),e.containerPoint=e.containerPoint?e.containerPoint:this._map.mouseEventToContainerPoint(e.originalEvent),e.layerPoint=e.layerPoint?e.layerPoint:this._map.containerPointToLayerPoint(e.containerPoint),e.latlng=e.latlng?e.latlng:this._map.layerPointToLatLng(e.layerPoint),this._mouseDownOrigin){this._latlngOrigin&&(e.latlng=this._latlngOrigin);var i=L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(i)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null,this._latlngOrigin=null},_updateStartHandler:function(){},_updateFinishHandler:function(){var t=0;this._markers!==i&&(t=this._markers.length),t>1&&(L.DomEvent.addListener(this._markers[t-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[t-1]._icon,"touchend",this._onMarkerMouseUp,this)),t>2&&(L.DomEvent.removeListener(this._markers[t-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[t-2]._icon,"touchend",this._onMarkerMouseUp))},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,className:"leaflet-div-icon leaflet-editing-icon",draggable:!1,clickable:!1,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),this._map.fire("draw:createmarker",{marker:e,layer:this}),e},_updateGuide:function(t){var e=0;this._markers!==i&&(e=this._markers.length),e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){if(this._tooltip){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)}},_drawGuide:function(t,e){var i,o,n,a=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),s=this.options.guidelineDistance,r=this.options.maxGuideLineLength,l=a>r?a-r:s;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));a>l;l+=this.options.guidelineDistance)i=l/a,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},n=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),n.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(n,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,o=this.options.showLength,n=0;return this._markers!==i&&(n=this._markers.length),0===n?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=o?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var o,n,a=0;this._markers!==i&&(a=this._markers.length),1>=a?this._measurementRunningTotal=0:(o=a-(e?2:1),n=t.distanceTo(this._markers[o].getLatLng()),this._measurementRunningTotal+=n*(e?1:-1))},_getMeasurementString:function(){var t=0;if(this._currentLatLng&&this._markers.length>0){var e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();t=this._measurementRunningTotal+e.distanceTo(i)}return L.GeometryUtil.readableDistance(t,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&(L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp))},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},toolbarIcon:{className:"leaflet-draw-draw-polygon",tooltip:L.drawLocal.draw.toolbar.buttons.polygon}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&(L.DomEvent.addListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp,this)),t>2&&(L.DomEvent.addListener(this._markers[t-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[t-1]._icon,"touchend",this._onMarkerMouseUp,this),t>3&&(L.DomEvent.removeListener(this._markers[t-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[t-2]._icon,"touchend",this._onMarkerMouseUp)))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp),t>2&&(L.DomEvent.removeListener(this._markers[t-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[t-1]._icon,"touchend",this._onMarkerMouseUp)))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._map.dragging&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),L.DomEvent.addListener(this._map._container,"mousedown",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"mousemove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"mouseup",this._onMouseUp,this),L.DomEvent.addListener(this._map._container,"touchstart",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onMouseUp,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.dragging&&this._map.dragging.enable(),this._container.style.cursor="",L.DomEvent.removeListener(this._map._container,"mousedown",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"mousemove",this._onMouseMove),L.DomEvent.removeListener(this._map._container,"mouseup",this._onMouseUp),L.DomEvent.removeListener(this._map._container,"touchstart",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"touchmove",this._onMouseMove),
L.DomEvent.removeListener(this._map._container,"touchend",this._onMouseUp),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint),this._isDrawing=!0;var e,i=this._map;t.touches&&(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY),i._container||(e=new L.Point(t.clientX,t.clientY));var o=i._container.getBoundingClientRect();e=new L.Point(t.clientX-o.left-i._container.clientLeft,t.clientY-o.top-i._container.clientTop);var n=i.containerPointToLayerPoint(e),a=i.layerPointToLatLng(n);this._startLatLng=a,t.preventDefault()},_onMouseMove:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint);var e,i=this._map;t.touches&&(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY),i._container||(e=new L.Point(t.clientX,t.clientY));var o=i._container.getBoundingClientRect();e=new L.Point(t.clientX-o.left-i._container.clientLeft,t.clientY-o.top-i._container.clientTop);var n=i.containerPointToLayerPoint(e),a=i.layerPointToLatLng(n);this._tooltip.updatePosition(a),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(a))},_onMouseUp:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint),this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,fillColor:null,fillOpacity:.5,clickable:!0},guidelineDistance:20,maxGuideLineLength:4e3,metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Draw.SimpleShape.prototype._getTooltipText.call(this),n=this._shape;return n&&(t=this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:o.text,subtext:i}}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,toolbarIcon:{className:"leaflet-draw-draw-circle",tooltip:L.drawLocal.draw.toolbar.buttons.circle}},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint),t.originalEvent.preventDefault();var e,i=t.latlng,o=this.options.showRadius,n=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:o?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,n):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-marker",tooltip:L.drawLocal.draw.toolbar.buttons.marker}},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},setStyle:function(t){return L.setOptions(this,t),this._container&&this._updateStyle(),this},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint),t.originalEvent.preventDefault();var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=new L.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(t){t.originalEvent=t.originalEvent?t.originalEvent:t,t.originalEvent.touches&&(t.originalEvent.clientX=t.originalEvent.clientX?t.originalEvent.clientX:t.originalEvent.touches[0].clientX,t.originalEvent.clientY=t.originalEvent.clientY?t.originalEvent.clientY:t.originalEvent.touches[0].clientY,this.startTouch=t.originalEvent.touches[0],this.lastTouch=t.originalEvent.touches[0]),t.containerPoint=t.containerPoint?t.containerPoint:this._map.mouseEventToContainerPoint(t.originalEvent),t.layerPoint=t.layerPoint?t.layerPoint:this._map.containerPointToLayerPoint(t.containerPoint),t.latlng=t.latlng?t.latlng:this._map.layerPointToLatLng(t.layerPoint),this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var t=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Wall=L.Draw.Polyline.extend({statics:{TYPE:"wall"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="wall"},_updateStartHandler:function(){var t=0;this._markers!==i&&(t=this._markers.length),3===t&&(L.DomEvent.addListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0,this))},_onMarkerMouseUp0:function(t){t.preventDefault(),this._closeShape()},_closeShape:function(){this.Poly=L.Polygon,this._finishShape(),this.Poly=L.Polyline},_cleanUpShape:function(){this._markers.length>1&&(L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp)),this._markers.length>2&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0),L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0))}}),L.Draw.Window=L.Draw.Polyline.extend({statics:{TYPE:"window"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="window"},_updateFinishHandler:function(){var t=this._markers.length;t>1&&(L.DomEvent.addListener(this._markers[t-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[t-1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}}),L.Draw.Door=L.Draw.Polyline.extend({statics:{TYPE:"door"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="door"},_updateFinishHandler:function(){var t=this._markers.length;t>1&&(L.DomEvent.addListener(this._markers[t-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[t-1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0},_toggleMarkerHighlight:function(){if(this._icon){var t=this._icon;t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display=""}},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,o=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=o+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._poly=t,L.setOptions(this,e)},addHooks:function(){var t=this._poly;t.setStyle(t.options.editing),this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly;t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,o,n=this._poly._latlngs;for(t=0,i=n.length;i>t;t++)o=this._createMarker(n[t],t),o.on("click",this._onMarkerClick,this),this._markers.push(o);var a,s;for(t=0,e=i-1;i>t;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(a=this._markers[e],s=this._markers[t],"wall"===this._poly.options.layerType&&this._createMiddleMarker(a,s),this._updatePrevNext(a,s))},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(i),i},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._poly.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire("edit",{layer:this._poly})},_onMarkerDrag:function(t){var e=t.target;L.DomEvent.preventDefault(t),L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly.redraw()},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._poly._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,o,n,a=this._getMiddleLatLng(t,e),s=this._createMarker(a);s.setOpacity(.6),t._middleRight=e._middleLeft=s,o=function(){var o=e._index;s._index=o,s.off("click",i,this).on("click",this._onMarkerClick,this),a.lat=s.getLatLng().lat,a.lng=s.getLatLng().lng,this._poly.spliceLatLngs(o,0,a),this._markers.splice(o,0,s),s.setOpacity(1),this._updateIndexes(o,1),e._index++,this._updatePrevNext(t,s),this._updatePrevNext(s,e),this._poly.fire("editstart")},n=function(){s.off("dragstart",o,this),s.off("dragend",n,this),this._createMiddleMarker(t,s),this._createMiddleMarker(s,e)},i=function(){o.call(this),n.call(this),this._fireEdit()},s.on("click",i,this).on("dragstart",o,this).on("dragend",n,this),this._markerGroup.addLayer(s)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,o=i.project(t.getLatLng()),n=i.project(e.getLatLng());return i.unproject(o._add(n)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(t,e){this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(t){var e=t.target;e.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit"),this._shape._map.fire("edit",{layer:this._shape})},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw()},_onMarkerDragEnd:function(t){var e=t.target;e.setOpacity(1),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds(),e=t.getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;i>e;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,o=i._cornerIndex;this._oppositeCorner=e[(o+2)%4],this._toggleCornerMarkers(0,o)},_onMarkerDragEnd:function(t){var e,i,o=t.target;o===this._moveMarker&&(e=this._shape.getBounds(),i=e.getCenter(),o.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape.getLatLngs(),o=this._shape.getBounds(),n=o.getCenter(),a=[],s=0,r=i.length;r>s;s++)e=[i[s].lat-n.lat,i[s].lng-n.lng],a.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(a),this._repositionCornerMarkers()},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter())},_getCorners:function(){var t=this._shape.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),o=t.getSouthEast(),n=t.getSouthWest();return[e,i,o,n]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t)},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i)}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,o=t.length;o>i;i++)e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,o=t.length,n=0,a=L.LatLng.DEG_TO_RAD;if(o>2){for(var s=0;o>s;s++)e=t[s],i=t[(s+1)%o],n+=(i.lng-e.lng)*a*(2+Math.sin(e.lat*a)+Math.sin(i.lat*a));n=6378137*n*6378137/2}return Math.abs(n)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},distance:function(t,e,i){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(i))},distanceSegment:function(t,e,i,o){var n=t.latLngToLayerPoint(e),a=t.latLngToLayerPoint(i),s=t.latLngToLayerPoint(o);return L.LineUtil.pointToSegmentDistance(n,a,s)},readableDistance:function(t,e){var i,o="imperial"!==e;return o?i=t>1e3?(t/1e3).toFixed(2)+" km":Math.round(100*t)/100+" m":(t*=1.09361,i=t>1760?(t/1760).toFixed(2)+" miles":Math.round(100*t)/100+" yd"),i},belongsSegment:function(t,e,o,n){n=n===i?.2:n;var a=e.distanceTo(o),s=e.distanceTo(t)+t.distanceTo(o)-a;return n>s/a},length:function(t){var e=L.GeometryUtil.accumulatedLengths(t);return e.length>0?e[e.length-1]:0},accumulatedLengths:function(t){if("function"==typeof t.getLatLngs&&(t=t.getLatLngs()),0===t.length)return[];for(var e=0,i=[0],o=0,n=t.length-1;n>o;o++)e+=t[o].distanceTo(t[o+1]),i.push(e);return i},closestOnSegment:function(t,e,i,o){var n=t.getMaxZoom();n===1/0&&(n=t.getZoom());var a=t.project(e,n),s=t.project(i,n),r=t.project(o,n),l=L.LineUtil.closestPointOnSegment(a,s,r);return t.unproject(l,n)},closest:function(t,e,i,o){"function"!=typeof e.getLatLngs&&(e=L.polyline(e));var n,a,s,r=e.getLatLngs().slice(0),l=1/0,h=null,p=1/0;if(o){for(n=0,a=r.length;a>n;n++)s=r[n],p=L.GeometryUtil.distance(t,i,s),l>p&&(l=p,h=s,p=p);return h?{latlng:h,distance:p}:null}for(e instanceof L.Polygon&&r.push(r[0]),n=0,a=r.length;a-1>n;n++){var d=r[n],c=r[n+1];p=L.GeometryUtil.distanceSegment(t,i,d,c),l>=p&&(l=p,h=L.GeometryUtil.closestOnSegment(t,i,d,c))}return h?{latlng:h,distance:l}:null},closestLayer:function(t,e,i){for(var o=1/0,n=null,a=null,s=1/0,r=0,l=e.length;l>r;r++){var h=e[r];"function"==typeof h.getLatLng?(a=h.getLatLng(),s=L.GeometryUtil.distance(t,i,a)):(a=L.GeometryUtil.closest(t,h,i),a&&(s=a.distance)),o>s&&(o=s,n={layer:h,latlng:a.latlng,distance:s})}return n},closestLayerSnap:function(t,e,i,o,n){o="number"==typeof o?o:1/0,n="boolean"==typeof n?n:!0;var a=L.GeometryUtil.closestLayer(t,e,i);if(!a||a.distance>o)return null;if(n&&"function"==typeof a.layer.getLatLngs){var s=L.GeometryUtil.closest(t,a.layer,a.latlng,!0);s.distance<o&&(a.latlng=s.latlng,a.distance=L.GeometryUtil.distance(t,s.latlng,i))}return a},interpolateOnPointSegment:function(t,e,i){return L.point(t.x*(1-i)+i*e.x,t.y*(1-i)+i*e.y)},interpolateOnLine:function(t,e,i){e=e instanceof L.Polyline?e.getLatLngs():e;var o=e.length;if(2>o)return null;if(0===i)return{latLng:e[0]instanceof L.LatLng?e[0]:L.latLng(e[0]),predecessor:-1};if(1===i)return{latLng:e[e.length-1]instanceof L.LatLng?e[e.length-1]:L.latLng(e[e.length-1]),predecessor:e.length-2};i=Math.max(Math.min(i,1),0);var n=t.getMaxZoom();n===1/0&&(n=t.getZoom());for(var a=[],s=0,r=0;o>r;r++)a[r]=t.project(e[r],n),r>0&&(s+=a[r-1].distanceTo(a[r]));for(var l=s*i,h=a[0],p=a[1],d=0,c=h.distanceTo(p),u=1;o>u&&l>c;u++)h=p,d=c,p=a[u],c+=h.distanceTo(p);var g=c-d!==0?(l-d)/(c-d):0,_=L.GeometryUtil.interpolateOnPointSegment(h,p,g);return{latLng:t.unproject(_,n),predecessor:u-2}},locateOnLine:function(t,e,i){var o=e.getLatLngs();if(i.equals(o[0]))return 0;if(i.equals(o[o.length-1]))return 1;for(var n=L.GeometryUtil.closest(t,e,i,!1),a=L.GeometryUtil.accumulatedLengths(o),s=a[a.length-1],r=0,l=!1,h=0,p=o.length-1;p>h;h++){var d=o[h],c=o[h+1];if(r=a[h],L.GeometryUtil.belongsSegment(n,d,c)){r+=d.distanceTo(n),l=!0;break}}if(!l)throw"Could not interpolate "+i.toString()+" within "+e.toString();return r/s},reverse:function(t){return L.polyline(t.getLatLngs().slice(0).reverse())},extract:function(t,e,i,o){if(i>o)return L.GeometryUtil.extract(t,L.GeometryUtil.reverse(e),1-i,1-o);i=Math.max(Math.min(i,1),0),o=Math.max(Math.min(o,1),0);var n=e.getLatLngs(),a=L.GeometryUtil.interpolateOnLine(t,e,i),s=L.GeometryUtil.interpolateOnLine(t,e,o);if(i===o){var r=L.GeometryUtil.interpolateOnLine(t,e,o);return[r.latLng]}-1===a.predecessor&&(a.predecessor=0),-1===s.predecessor&&(s.predecessor=0);var l=n.slice(a.predecessor+1,s.predecessor+1);return l.unshift(a.latLng),l.push(s.latLng),l},isBefore:function(t,e){if(!e)return!1;var i=t.getLatLngs(),o=e.getLatLngs();return i[i.length-1].equals(o[0])},isAfter:function(t,e){if(!e)return!1;var i=t.getLatLngs(),o=e.getLatLngs();return i[0].equals(o[o.length-1])},startsAtExtremity:function(t,e){if(!e)return!1;var i=t.getLatLngs(),o=e.getLatLngs(),n=i[0];return n.equals(o[0])||n.equals(o[o.length-1])},computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},computeSlope:function(t,e){var i=(e.y-t.y)/(e.x-t.x),o=t.y-i*t.x;return{a:i,b:o}},rotatePoint:function(t,e,i,o){var n=t.getMaxZoom();n===1/0&&(n=t.getZoom());var a=i*Math.PI/180,s=t.project(e,n),r=t.project(o,n),l=Math.cos(a)*(s.x-r.x)-Math.sin(a)*(s.y-r.y)+r.x,h=Math.sin(a)*(s.x-r.x)+Math.cos(a)*(s.y-r.y)+r.y;return t.unproject(new L.Point(l,h),n)}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,o=this._originalPoints,n=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=n-1;t>=3;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._originalPoints,o=i?i.length:0,n=i?i[o-1]:null,a=o-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(n,t,a,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,i=e?e.length:0;return i+=t||0,!this._originalPoints||3>=i},_lineSegmentsIntersectsRange:function(t,e,i,o){var n,a,s=this._originalPoints;o=o||0;for(var r=i;r>o;r--)if(n=s[r-1],a=s[r],L.LineUtil.segmentsIntersect(t,e,n,a))return!0;return!1},isConvex:function(){var t,e,i,o=this._originalPoints,n=o?o.length:0;if(3>n)return!1;for(var a=0,s=0;n-1>a;a++)for(var r=0;n-2>r;r++)if(t=o[a%n],e=o[(a+r+1)%n],i=o[(a+r+2)%n],0===s&&(s=(i.y-t.y)*(e.x-t.x)-(e.y-t.y)*(i.x-t.x)),s*((i.y-t.y)*(e.x-t.x)-(e.y-t.y)*(i.x-t.x))<0)return!1;return 0!==s?!0:!1}}),L.Polygon.include({intersects:function(){var t,e,i,o,n,a=this._originalPoints;return this._tooFewPointsForIntersection()?!1:(t=L.Polyline.prototype.intersects.call(this))?!0:(e=a.length,i=a[0],o=a[e-1],n=e-2,this._lineSegmentsIntersectsRange(o,i,n,1))}}),L.GeometryUtil=L.extend(L.GeometryUtil||{},{closestGridSnap:function(t,e,o,n){if(o===i)return null;if(1e-11>o)return null;n="number"==typeof n?n:1/0;var a=Math.cos(e.lat*Math.PI/180),s=6378137*Math.PI,r=180*o/(s*a),l=180*o/s,h=Math.round((e.lat-Math.round(e.lat))/r)*r+Math.round(e.lat),p=Math.round(e.lng/l)*l,d={};return d.latlng=new L.LatLng(h,p),d.distance=t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(d.latlng)),d.GridStep=o,!d||d.distance>n?null:d}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e;this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o=!1,n="leaflet-draw-toolbar-top";for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&(e=this._toolbars[a].addToolbar(t),e&&(o||(L.DomUtil.hasClass(e,n)||L.DomUtil.addClass(e.childNodes[0],n),o=!0),i.appendChild(e)));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable();
},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,n=this._toolbarClass||"",a=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<a.length;e++)a[e].enabled&&this._initModeHandler(a[e].handler,this._toolbarContainer,o++,n,a[e].title);return o?(this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i):void 0},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;i>e;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,n){var a=t.type;this._modes[a]={},this._modes[a].handler=t,this._modes[a].button=this._createButton({title:n,className:o+"-"+a,container:e,callback:this._modes[a].handler.enable,context:this._modes[a].handler}),this._modes[a].buttonIndex=i,this._modes[a].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,n,a=this._actionsContainer,s=this.getActions(t),r=s.length;for(i=0,o=this._actionButtons.length;o>i;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];a.firstChild;)a.removeChild(a.firstChild);for(var l=0;r>l;l++)"enabled"in s[l]&&!s[l].enabled||(e=L.DomUtil.create("li","",a),n=this._createButton({title:s[l].title,text:s[l].text,container:e,callback:s[l].callback,context:s[l].context}),this._actionButtons.push({button:n,callback:s[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{wall:{},window:{},door:{},rectangle:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.wall,handler:new L.Draw.Wall(t,this.options.wall),title:L.drawLocal.draw.toolbar.buttons.wall},{enabled:this.options.window,handler:new L.Draw.Window(t,this.options.window),title:L.drawLocal.draw.toolbar.buttons.window},{enabled:this.options.door,handler:new L.Draw.Door(t,this.options.door),title:L.drawLocal.draw.toolbar.buttons.door},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle}]},getActions:function(){return[{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:.6,dashArray:"10, 10",fill:!1,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(t){t.edit&&("undefined"==typeof t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=this.options.featureGroup,i=0!==e.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this),this._map.fire("draw:editstart_after",{handler:this.type}))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._map.dragging&&this._map.dragging.disable())},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._map.dragging&&this._map.dragging.enable())},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire("draw:edited",{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}),t._map&&t._map.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i=t.layer||t.target||t;return i.editing?(this._backupLayer(i),this.options.selectedPathOptions&&(e=L.Util.extend({},this.options.selectedPathOptions),e.maintainColor&&(e.color=i.options.color,e.fillColor=i.options.fillColor),i.options.original=L.extend({},i.options),i.options.editing=e),void i.editing.enable()):!1},_disableLayerEdit:function(t){var e=t.layer||t.target||t;return e.editing?(e.edited=!1,e.editing.disable(),delete e.options.editing,void delete e.options.original):!1},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},options:{icon:new L.DivIcon({iconSize:new L.Point(26,26),className:"leaflet-div-icon leaflet-delete-icon"})},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t}),this._map.fire("revert-edited",{layer:t})},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(t){var e=t.layer||t.target||t;e.on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length},_initMarkers:function(){var t=this;this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var e,o,n,a;this._deletableLayers.eachLayer(function(s){if(s.editing._poly!==i||s.editing._shape!==i){if(s.editing._poly&&(a=s.editing._poly._latlngs),s.editing._shape&&(a=s.editing._shape._latlngs),!a||a.length<2)return;e=a[0],o=new L.LatLng(e.lat,e.lng);var r=new L.Marker(o,{draggable:!1,icon:t.options.icon});r.setOpacity(.6),r._origLatLng=o,n=function(){t._removeLayer({layer:s}),r.setOpacity(1)},r.on("click",n),t._markerGroup.addLayer(r)}})}}),L.Handler.MarkerSnap=L.Handler.extend({options:{snapType:"undefined",gridStep:.1,snapDistance:6,snapToGrid:!0,snapToObjects:!0,snapVertices:!0},initialize:function(t,e,i){function o(){this._buffer=t.layerPointToLatLng(new L.Point(0,0)).lat-t.layerPointToLatLng(new L.Point(this.options.snapDistance,0)).lat}L.Handler.prototype.initialize.call(this,t),this._markers=[],this._guides=[],2===arguments.length&&(e instanceof L.Class||(i=e,e=null)),L.Util.setOptions(this,i||{}),e&&(e.dragging||(e.dragging=new L.Handler.MarkerDrag(e)),e.dragging.enable(),this.watchMarker(e)),t.on("zoomend",o,this),t.whenReady(o,this),o.call(this)},enable:function(){this.disable();for(var t=0;t<this._markers.length;t++)this.watchMarker(this._markers[t])},disable:function(){for(var t=0;t<this._markers.length;t++)this.unwatchMarker(this._markers[t])},watchMarker:function(t){-1===this._markers.indexOf(t)&&this._markers.push(t),t.on("move",this._snapMarker,this)},unwatchMarker:function(t){t.off("move",this._snapMarker,this),delete t.snap},addGuideLayer:function(t){for(var e=0,i=this._guides.length;i>e&&L.stamp(t)!==L.stamp(this._guides[e]);e++);return this._guides.push(t),this._guides},addGuideLayersFromGroup:function(t){return t.eachLayer(this.addGuideLayer,this),this._guides},removeGuideLayer:function(t){for(var e=0,i=this._guides.length;i>e;e++)if(L.stamp(t)===L.stamp(this._guides[e])){this._guides.splice(e,1);break}return this._guides},_snapMarker:function(t){function e(t){if(t._layers!==i&&"function"!=typeof t.searchBuffer)for(var o in t._layers)e(t._layers[o]);else"function"==typeof t.searchBuffer?a=a.concat(t.searchBuffer(n,this._buffer)):a.push(t)}var o=t.target,n=o.getLatLng(),a=[],s=null;if(this.options.snapToGrid&&(s=this._findClosestGridSnap(this._map,n,this.options.gridStep,this.options.snapDistance),null!==s))return void this._updateSnap(o,o,s.latlng);if(this.options.snapToObjects){for(var r=0,l=this._guides.length;l>r;r++){var h=this._guides[r];h.snapediting!==i&&o._leaflet_id in h.snapediting._markerGroup._layers||e.call(this,h)}s=this._findClosestLayerSnap(this._map,a,n,this.options.snapDistance,this.options.snapVertices)}s=s||{layer:null,latlng:null},this._updateSnap(o,s.layer,s.latlng)},_findClosestLayerSnap:function(t,e,i,o,n){return L.GeometryUtil.closestLayerSnap(t,e,i,o,n)},_findClosestGridSnap:function(t,e,i,o){return L.GeometryUtil.closestGridSnap(t,e,i,o)},_updateSnap:function(t,e,i){e&&i?(t._latlng=L.latLng(i),t.update(),t.snap!==e&&(t.snap=e,t._icon&&L.DomUtil.addClass(t._icon,"marker-snapped"),t.fire("snap",{layer:e,latlng:i}))):(t.snap&&(t._icon&&L.DomUtil.removeClass(t._icon,"marker-snapped"),t.fire("unsnap",{layer:t.snap})),delete t.snap)}}),L.Handler.PolylineSnap=L.Edit.Poly.extend({initialize:function(t,e,i){var o=this;L.Edit.Poly.prototype.initialize.call(this,e,i),this._snapper=new L.Handler.MarkerSnap(t,i),e.on("remove",function(){o._snapper.disable()})},addGuideLayer:function(t){return this._snapper.addGuideLayer(t),this._snapper._guides},addGuideLayersFromGroup:function(t){return t.eachLayer(this.addGuideLayer,this),this._snapper._guides},removeGuideLayer:function(t){return this._snapper.removeGuideLayer(t),this._snapper._guides},_createMarker:function(t,e){var o=L.Edit.Poly.prototype._createMarker.call(this,t,e),n=e===i;return n?o.on("dragstart",function(){this._snapper.watchMarker(o)},this):this._snapper.watchMarker(o),o}}),L.Draw.Feature.SnapMixin={_snapInitialize:function(){this.on("enabled",this._snapOnEnabled,this),this.on("disabled",this._snapOnDisabled,this)},_snapOnEnabled:function(){if(this.options.guideLayers&&this._mouseMarker){this._snapper||(this._snapper=new L.Handler.MarkerSnap(this._map),L.Util.setOptions(this._snapper,this.options));for(var t=0,e=this.options.guideLayers.length;e>t;t++)this._snapper.addGuideLayer(this.options.guideLayers[t]);var i=this._mouseMarker;this._snapper.watchMarker(i);var o=i.options.icon;i.on("snap",function(){i.setIcon(this.options.icon),i.setOpacity(1)},this),i.on("unsnap",function(){i.setIcon(o),i.setOpacity(0)},this),i.on("click",this._snapOnClick,this)}},_snapOnClick:function(t){if(this._markers){var e=this._markers.length,i=this._markers[e-1];if(this._mouseMarker.snap&&t&&i){if(i.setLatLng(t.target._latlng),this._poly){var o=this._poly._latlngs.length;this._poly._latlngs[o-1]=t.target._latlng,this._poly.redraw()}i._icon&&L.DomUtil.addClass(i._icon,"marker-snapped")}}},_snapOnDisabled:function(){this._mouseMarker&&this._mouseMarker.off("click",this._snapOnClick,this),delete this._snapper}},L.Draw.Feature.include(L.Draw.Feature.SnapMixin),L.Draw.Feature.addInitHook("_snapInitialize"),L.Control.GraphicScale=L.Control.extend({options:{position:"bottomleft",updateWhenIdle:!1,minUnitWidth:30,maxUnitsWidth:240,fill:"fill",showSubunits:!1,doubleLine:!1,labelPlacement:"auto"},onAdd:function(t){return this._map=t,this._possibleUnitsNum=[3,5,2,4],this._possibleUnitsNumLen=this._possibleUnitsNum.length,this._possibleDivisions=[1,.5,.25,.2],this._possibleDivisionsLen=this._possibleDivisions.length,this._possibleDivisionsSub={1:{num:2,division:.5},.5:{num:5,division:.1},.25:{num:5,division:.05},.2:{num:2,division:.1}},this._scaleInner=this._buildScale(),this._scale=this._addScale(this._scaleInner),this._setStyle(this.options),t.on(this.options.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),t.options.graphicScaleControl=this._scale,this._scale},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScale:function(t){var e=L.DomUtil.create("div");return e.className="leaflet-control-graphicscale",e.appendChild(t),e},_setStyle:function(t){var e=["leaflet-control-graphicscale-inner"];t.fill&&"nofill"!==t.fill&&(e.push("filled"),e.push("filled-"+t.fill)),t.showSubunits&&e.push("showsubunits"),t.doubleLine&&e.push("double"),e.push("labelPlacement-"+t.labelPlacement),this._scaleInner.className=e.join(" ")},_buildScale:function(){var t=e.createElement("div");t.className="leaflet-control-graphicscale-inner";var i=L.DomUtil.create("div","subunits",t),o=L.DomUtil.create("div","units",t);this._units=[],this._unitsLbls=[],this._subunits=[];for(var n=0;5>n;n++){var a=this._buildDivision(n%2===0);o.appendChild(a),this._units.push(a);var s=this._buildDivisionLbl();a.appendChild(s),this._unitsLbls.push(s);var r=this._buildDivision(n%2===1);i.appendChild(r),this._subunits.unshift(r)}return this._zeroLbl=L.DomUtil.create("div","label zeroLabel"),this._zeroLbl.innerHTML="0",this._units[0].appendChild(this._zeroLbl),this._subunitsLbl=L.DomUtil.create("div","label subunitsLabel"),this._subunitsLbl.innerHTML="?",this._subunits[4].appendChild(this._subunitsLbl),t},_buildDivision:function(t){var e=L.DomUtil.create("div","division"),i=L.DomUtil.create("div","line");e.appendChild(i);var o=L.DomUtil.create("div","line2");return e.appendChild(o),t&&i.appendChild(L.DomUtil.create("div","fill")),t||o.appendChild(L.DomUtil.create("div","fill")),e},_buildDivisionLbl:function(){var t=L.DomUtil.create("div","label divisionLabel");return t},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),o=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,n=this._map.getSize();n.x>0&&this._updateScale(o,this.options)},_updateScale:function(t,e){var i=this._getBestScale(t,e.minUnitWidth,e.maxUnitsWidth);this._render(i)},_getBestScale:function(t,e,i){var o=this._getPossibleUnits(t,e,this._map.getSize().x),n=this._getPossibleScales(o,i);n.sort(function(t,e){return e.score-t.score});var a=n[0];return a.subunits=this._getSubunits(a),a},_getSubunits:function(t){var e=this._possibleDivisionsSub[t.unit.unitDivision],i={};i.subunitDivision=e.division,i.subunitMeters=e.division*(t.unit.unitMeters/t.unit.unitDivision),i.subunitPx=e.division*(t.unit.unitPx/t.unit.unitDivision);var o={subunit:i,numSubunits:e.num,total:e.num*i.subunitMeters};return o},_getPossibleScales:function(t,e){for(var i,o=[],n=Number.POSITIVE_INFINITY,a=0;a<this._possibleUnitsNumLen;a++)for(var s=this._possibleUnitsNum[a],r=.5*(this._possibleUnitsNumLen-a),l=0;l<t.length;l++){var h=t[l],p=h.unitPx*s,d={unit:h,totalWidthPx:p,numUnits:s,score:0},c=1-(e-p)/e;c*=3;var u=h.unitScore+r+c;(.25===h.unitDivision&&3===s||.5===h.unitDivision&&3===s||.25===h.unitDivision&&5===s)&&(u-=2),d.score=u,e>p&&o.push(d),n>p&&(n=p,i=d)}return o.length||o.push(i),o},_getPossibleUnits:function(t,e,i){for(var o,n=(Math.floor(t)+"").length,a=[],s=n;s>-2;s--){o=Math.pow(10,s);for(var r=0;r<this._possibleDivisionsLen;r++){var l=o*this._possibleDivisions[r],h=i*(l/t);if(e>h)return a;a.push({unitMeters:l,unitPx:h,unitDivision:this._possibleDivisions[r],unitScore:this._possibleDivisionsLen-r})}}return a},_render:function(t){this._renderPart(t.unit.unitPx,t.unit.unitMeters,t.numUnits,this._units,this._unitsLbls),this._renderPart(t.subunits.subunit.subunitPx,t.subunits.subunit.subunitMeters,t.subunits.numSubunits,this._subunits);var e=this._getDisplayUnit(t.subunits.total);this._subunitsLbl.innerHTML=""+e.amount+e.unit},_renderPart:function(t,e,i,o,n){for(var a=this._getDisplayUnit(e),s=0;s<this._units.length;s++){var r=o[s];if(i>s?(r.style.width=t+"px",r.className="division"):(r.style.width=0,r.className="division hidden"),n){var l=n[s],h=["label","divisionLabel"];if(i>s){var p;p=a.amount<1?((s+1)*a.amount).toFixed(2):((s+1)*a.amount).toFixed(0),s===i-1?(p+=a.unit,h.push("labelLast")):h.push("labelSub"),l.innerHTML=p}l.className=h.join(" ")}}},_getDisplayUnit:function(t){1>t&&(t=t.toFixed(2));var e=1e3>t?"m":"km";return{unit:e,amount:"km"===e?t/1e3:t}}}),L.Map.mergeOptions({graphicScaleControl:!1}),L.control.graphicScale=function(t){return new L.Control.GraphicScale(t)},L.Map.addInitHook(function(){this.options.graphicScaleControl&&(this.graphicScaleControl=L.control.graphicScale({doubleLine:!1,fill:"fill",showSubunits:!0}).addTo(this))}),L.SimpleGraticule=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[{start:0,end:3,interval:5e6},{start:4,end:5,interval:5e5},{start:6,end:7,interval:2e5},{start:8,end:9,interval:1e5},{start:10,end:10,interval:3e4},{start:11,end:11,interval:1e4},{start:12,end:12,interval:6e3},{start:13,end:13,interval:3e3},{start:14,end:14,interval:2e3},{start:15,end:15,interval:1e3},{start:16,end:16,interval:500},{start:17,end:17,interval:250},{start:18,end:19,interval:100},{start:20,end:20,interval:30},{start:21,end:21,interval:10},{start:22,end:22,interval:6},{start:23,end:23,interval:3},{start:24,end:24,interval:2},{start:25,end:25,interval:1},{start:26,end:26,interval:.5},{start:27,end:27,interval:.2},{start:28,end:28,interval:.1},{start:29,end:29,interval:.06},{start:30,end:31,interval:.04},{start:32,end:41,interval:.02}]},lineStyle:{stroke:!0,color:"#111",opacity:.6,weight:1,clickable:!1},initialize:function(t){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,t)},onAdd:function(t){this._map=t;var e=this.redraw();this._map.on("viewreset "+this.options.redraw,e.redraw,e),this.eachLayer(t.addLayer,t)},onRemove:function(t){t.off("viewreset "+this.options.redraw,this.map),this.eachLayer(this.removeLayer,this),this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0,this.redraw()},show:function(){this.options.hidden=!1,this.redraw()},redraw:function(){if(this._bounds=this._map.getBounds().pad(0),this.clearLayers(),!this.options.hidden){for(var t=this._map.getZoom(),e=0;e<this.options.zoomIntervals.length;e++)if(t>=this.options.zoomIntervals[e].start&&t<=this.options.zoomIntervals[e].end){this.options.interval=this.options.zoomIntervals[e].interval;break}this.constructLines(this.getMins(),this.getLineCounts()),this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,o=180*i/(e*t),n=180*i/e;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/o),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/n)}},getMins:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,o=180*i/(e*t),n=180*i/e;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/o)*o+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/n)*n}},constructLines:function(t,e){for(var i=new Array(e.x+e.y),o=new Array(e.x+e.y),n=Math.cos(this._bounds.getCenter().lat*Math.PI/180),a=6378137*Math.PI,s=this.options.interval,r=180*s/(a*n),l=180*s/a,h=0;h<=e.x;h++){var p=t.x+h*r;i[h]=this.buildXLine(p),this.options.showOriginLabel&&(o[h]=this.buildLabel("gridlabel-horiz",p))}for(var d=0;d<=e.y;d++){var c=t.y+d*l;i[d+h]=this.buildYLine(c),this.options.showOriginLabel&&(o[d+h]=this.buildLabel("gridlabel-vert",c))}i.forEach(this.addLayer,this),this.options.showOriginLabel&&o.forEach(this.addLayer,this),this.eachLayer(function(t){t.bringToBack()})},buildXLine:function(t){var e=new L.LatLng(this._bounds.getSouth(),t),i=new L.LatLng(this._bounds.getNorth(),t);return new L.Polyline([e,i],this.lineStyle)},buildYLine:function(t){var e=new L.LatLng(t,this._bounds.getWest()),i=new L.LatLng(t,this._bounds.getEast());return new L.Polyline([e,i],this.lineStyle)},buildLabel:function(t,e){var i,o=this._map.getBounds().pad(-0);return i="gridlabel-horiz"===t?new L.LatLng(o.getCenter().lng,e):new L.LatLng(e,o.getCenter().lat),L.marker(i,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="'+t+'">'+e+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}}),L.simpleGraticule=function(t){return new L.SimpleGraticule(t)},L.Map.addInitHook(function(){this.options.simpleGraticule&&(this.options.simpleGraticule=(new L.simpleGraticule).addTo(this))}),L.SnapGrid=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[]},lineStyle:{stroke:!0,color:"red",opacity:.3,weight:1,clickable:!1,dashArray:"8,2"},initialize:function(t){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,t)},onAdd:function(t){this._map=t;var e=this.redraw();this._map.on("viewreset "+this.options.redraw,e.redraw,e),this.eachLayer(t.addLayer,t)},onRemove:function(t){t.off("viewreset "+this.options.redraw,this.map),this.eachLayer(this.removeLayer,this),this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0,this.redraw()},show:function(){this.options.hidden=!1,this.redraw()},redraw:function(){if(this._bounds=this._map.getBounds().pad(0),this.clearLayers(),!this.options.hidden){var t=this.getLineCounts();t.x+t.y<300&&this.constructLines(this.getMins(),this.getLineCounts()),this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,o=180*i/(e*t),n=180*i/e;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/o),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/n)}},getMins:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,o=180*i/(e*t),n=180*i/e;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/o)*o+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/n)*n}},constructLines:function(t,e){for(var i=new Array(e.x+e.y),o=new Array(e.x+e.y),n=Math.cos(this._bounds.getCenter().lat*Math.PI/180),a=6378137*Math.PI,s=this.options.interval,r=180*s/(a*n),l=180*s/a,h=0;h<=e.x;h++){var p=t.x+h*r;i[h]=this.buildXLine(p),this.options.showOriginLabel&&(o[h]=this.buildLabel("gridlabel-horiz",p))}for(var d=0;d<=e.y;d++){var c=t.y+d*l;i[d+h]=this.buildYLine(c),this.options.showOriginLabel&&(o[d+h]=this.buildLabel("gridlabel-vert",c))}i.forEach(this.addLayer,this),this.options.showOriginLabel&&o.forEach(this.addLayer,this),this.eachLayer(function(t){t.bringToBack()})},buildXLine:function(t){var e=new L.LatLng(this._bounds.getSouth(),t),i=new L.LatLng(this._bounds.getNorth(),t);return new L.Polyline([e,i],this.lineStyle)},buildYLine:function(t){var e=new L.LatLng(t,this._bounds.getWest()),i=new L.LatLng(t,this._bounds.getEast());return new L.Polyline([e,i],this.lineStyle)},buildLabel:function(t,e){var i,o=this._map.getBounds().pad(-0);return i="gridlabel-horiz"===t?new L.LatLng(o.getCenter().lng,e):new L.LatLng(e,o.getCenter().lat),L.marker(i,{clickable:!1,icon:L.divIcon({
iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="'+t+'">'+e+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}}),L.snapGrid=function(t){return new L.SnapGrid(t)},L.Map.addInitHook(function(){this.options.snapGrid&&(this.options.snapGrid=(new L.snapGrid).addTo(this))}),function(e){var i;if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)i=require("leaflet"),module.exports=e(i);else{if("undefined"==typeof t.L)throw new Error("Leaflet must be loaded first");e(t.L)}}(function(t){t.Map.mergeOptions({contextmenu:!0,contextmenuWidth:150,contextmenuItems:[{text:"Center map here",callback:function(t){this.panTo(t.latlng)}},{text:"Show all squares",callback:function(){this.fire("redraw:showAllSquareLabels")}}]}),t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e),this._map=e,this._items=[],this._visible=!1;var i=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);i.style.zIndex=1e4,i.style.position="absolute",e.options.contextmenuWidth&&(i.style.width=e.options.contextmenuWidth+"px"),this._createItems(),t.DomEvent.on(i,"click",t.DomEvent.stop).on(i,"mousedown",t.DomEvent.stop).on(i,"dblclick",t.DomEvent.stop).on(i,"contextmenu",t.DomEvent.stop)},addHooks:function(){t.DomEvent.on(e,t.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).on(e,"keydown",this._onKeyDown,this),this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide,click:this._hide},this),this._map.on({"popups:hide":this._onPopupsHide},this),t.DomEvent.on(this._map.getContainer(),"mouseleave",this._hide,this)},_onPopupsHide:function(t){t.caller&&t.caller!==this&&this._hide()},removeHooks:function(){t.DomEvent.off(e,t.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).off(e,"keydown",this._onKeyDown,this),this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide,click:this._hide},this),this._map.off({"popups:hide":this._onPopupsHide},this),t.DomEvent.off(this._map.getContainer(),"mouseleave",this._hide,this)},showAt:function(e,i){e instanceof t.LatLng&&(e=this._map.latLngToContainerPoint(e)),this._showAtPoint(e,i)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=e!==i?e:this._items.length;var o=this._createItem(this._container,t,e);return this._items.push(o),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:o.el,index:e}),o.el},removeItem:function(e){var i=this._container;isNaN(e)||(e=i.children[e]),e&&(this._removeItem(t.Util.stamp(e)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e}))},removeAllItems:function(){for(var e;this._container.children.length;)e=this._container.children[0],this._removeItem(t.Util.stamp(e))},hideAllItems:function(){var t,e,i;for(e=0,i=this._items.length;i>e;e++)t=this._items[e],t.el.style.display="none"},showAllItems:function(){var t,e,i;for(e=0,i=this._items.length;i>e;e++)t=this._items[e],t.el.style.display=""},setDisabled:function(e,i){var o=this._container,n=t.Map.ContextMenu.BASE_CLS+"-item";isNaN(e)||(e=o.children[e]),e&&t.DomUtil.hasClass(e,n)&&(i?(t.DomUtil.addClass(e,n+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})):(t.DomUtil.removeClass(e,n+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})))},isVisible:function(){return this._visible},_createItems:function(){var t,e,i=this._map.options.contextmenuItems;for(t=0,e=i.length;e>t;t++)this._items.push(this._createItem(this._container,i[t]))},_createItem:function(e,i,o){if(i.separator||"-"===i)return this._createSeparator(e,o);var n=t.Map.ContextMenu.BASE_CLS+"-item",a=i.disabled?n+" "+n+"-disabled":n,s=this._insertElementAt("a",a,e,o),r=this._createEventHandler(s,i.callback,i.context,i.hideOnSelect),l="";return i.icon?l='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+i.icon+'"/>':i.iconCls&&(l='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+i.iconCls+'"></span>'),s.innerHTML=l+i.text,s.href="#",t.DomEvent.on(s,"mouseover",this._onItemMouseOver,this).on(s,"mouseout",this._onItemMouseOut,this).on(s,"mousedown",t.DomEvent.stopPropagation).on(s,"click",r),{id:t.Util.stamp(s),el:s,callback:r}},_removeItem:function(e){var i,o,n,a;for(n=0,a=this._items.length;a>n;n++)if(i=this._items[n],i.id===e){o=i.el;var s=i.callback;return s&&t.DomEvent.off(o,"mouseover",this._onItemMouseOver,this).off(o,"mouseover",this._onItemMouseOut,this).off(o,"mousedown",t.DomEvent.stopPropagation).off(o,"click",i.callback),this._container.removeChild(o),this._items.splice(n,1),i}return null},_createSeparator:function(e,i){var o=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,i);return{id:t.Util.stamp(o),el:o}},_createEventHandler:function(e,o,n,a){var s=this,r=this._map,l=t.Map.ContextMenu.BASE_CLS+"-item-disabled";return a=a!==i?a:!0,function(){t.DomUtil.hasClass(e,l)||(a&&s._hide(),o&&o.call(n||r,s._showLocation),s._map.fire("contextmenu:select",{contextmenu:s,el:e}))}},_insertElementAt:function(t,o,n,a){var s,r=e.createElement(t);return r.className=o,a!==i&&(s=n.children[a]),s?n.insertBefore(r,s):n.appendChild(r),r},_show:function(t){this._map.fire("popups:hide",{caller:this}),this._showAtPoint(t.containerPoint)},_showAtPoint:function(e,i){if(this._items.length){var o=this._map,n=o.containerPointToLayerPoint(e),a=o.layerPointToLatLng(n),s={contextmenu:this};i&&(s=t.extend(i,s)),this._showLocation={latlng:a,layerPoint:n,containerPoint:e},this._setPosition(e),this._visible?this._setPosition(e):(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",s)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(e){var i,o=this._map.getSize(),n=this._container,a=this._getElementSize(n);this._map.options.contextmenuAnchor&&(i=t.point(this._map.options.contextmenuAnchor),e=e.add(i)),n._leaflet_pos=e,e.x+a.x>o.x?(n.style.left="auto",n.style.right=Math.max(o.x-e.x,0)+"px"):(n.style.left=Math.max(e.x,0)+"px",n.style.right="auto"),e.y+a.y>o.y?(n.style.top="auto",n.style.bottom=Math.max(o.y-e.y,0)+"px"):(n.style.top=Math.max(e.y,0)+"px",n.style.bottom="auto")},_getElementSize:function(t){var e=this._size,i=t.style.display;return(!e||this._sizeChanged)&&(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=i,this._sizeChanged=!1),e},_onMouseDown:function(){this._hide()},_onKeyDown:function(t){var e=t.keyCode;27===e&&this._hide()},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}}),t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu),t.Mixin.ContextMenu={bindContextMenu:function(e){return t.setOptions(this,e),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(t){var e,i,o,n;if(this._map.contextmenu){for(i=this._map.mouseEventToContainerPoint(t.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),o=0,n=this.options.contextmenuItems.length;n>o;o++)e=this.options.contextmenuItems[o],this._items.push(this._map.contextmenu.insertItem(e,e.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(i,{relatedTarget:this})}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;e>t;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var o,n,a,s=[t.Marker,t.Path],r={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0},l=function(){this.options.contextmenu&&this._initContextMenu()};for(n=0,a=s.length;a>n;n++)o=s[n],o.prototype.options?o.mergeOptions(r):o.prototype.options=r,o.addInitHook(l),o.include(t.Mixin.ContextMenu);return t.Map.ContextMenu}),L.Control.SlideMenu=L.Control.extend({options:{isOpen:!1,position:"topright",width:"100%",height:"40px",delay:"0",closeButtonIcon:"fa-angle-double-up",menuButtonIcon:"fa-angle-double-down"},contents:['<span class="leaflet-top-menu-spacer">&nbsp;</span>','<a class="leaflet-top-menu-link"><b> Load </b></a>','<a class="leaflet-top-menu-link"><b> Save </b></a>','<a class="leaflet-top-menu-link"><b> SVG </b></a>','<a class="leaflet-top-menu-link"><b> PNG </b></a>','<a class="leaflet-top-menu-link"><b> JPG </b></a>','<a class="leaflet-top-menu-link"><b> Options </b></a>'],initialize:function(t,e){e&&L.Util.setOptions(this,e),t?this._innerHTML=t:this._innerHTML=this.contents.join(""),this._startPosition=0,this._isLeftPosition="topleft"===this.options.position||"buttomleft"===this.options.position?!0:!1},onAdd:function(t){return this._map=t,this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*t.getSize().x*.01),this._container=L.DomUtil.create("div","leaflet-control-slidemenu leaflet-bar leaflet-control"),this.showlink=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",this._container),this.showlink.title="Menu",this.options.menuButtonIcon.length>0?L.DomUtil.create("span","fa "+this.options.menuButtonIcon,this.showlink):L.DomUtil.create("span","fa fa-bars",this.showlink),this._menu=L.DomUtil.create("div","leaflet-menu",e.getElementsByClassName("leaflet-container")[0]),this._menu.style.width=this.options.width,this._menu.style.height=this.options.height,this.closeButton=L.DomUtil.create("span","leaflet-menu-close-button fa",this._menu),this.options.closeButtonIcon.length>0?(this._isLeftPosition=!0,this._menu.style.left="-"+this.options.width,this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,this.options.closeButtonIcon)):this._isLeftPosition?(this._menu.style.left="-"+this.options.width,this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,"fa-chevron-left")):(this.closeButton.style["float"]="left",this._menu.style.right="-"+this.options.width,L.DomUtil.addClass(this.closeButton,"fa-chevron-right")),this._contents=L.DomUtil.create("div","leaflet-menu-contents",this._menu),this._contents.innerHTML=this._innerHTML,L.DomEvent.addListener(this._contents.getElementsByTagName("A")[0],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.loadDialog._isOpen;this._map.RSWEIndoor.options.dialogs.loadDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.loadDialog.close()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[1],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.saveDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.saveDialog.close()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[2],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.saveSVGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveSVGDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.saveSVGDialog.close()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[3],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.savePNGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.savePNGDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.savePNGDialog.close()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[4],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.saveJPGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveJPGDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.saveJPGDialog.close()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[5],"click",function(){this.menuClose();var t=this._map.RSWEIndoor.options.dialogs.optionsDialog._isOpen;this._map.RSWEIndoor.options.dialogs.optionsDialog.open(),t&&this._map.RSWEIndoor.options.dialogs.optionsDialog.close()},this),L.DomEvent.disableClickPropagation(this._menu),L.DomEvent.on(this.showlink,"click",function(){this.menuOpen()},this).on(this.closeButton,"click",function(){this.menuClose()},this),this.options.isOpen?this._animate(this._menu,this._startPosition,0,!0):this._animate(this._menu,0,this._startPosition,!1),this._container},menuOpen:function(){this.showlink.style.display="none",this.closeButton.style.display="block",this._animate(this._menu,this._startPosition,0,!0)},menuClose:function(){this.showlink.style.display="block",this.closeButton.style.display="none",this._animate(this._menu,0,this._startPosition,!1)},setContents:function(t){this._innerHTML=t},_animate:function(t,e,i,o){if(this.options.isOpen=o,o||(this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*this._map.getSize().x*.01),this._menu.style.width=this.options.width,e=0,i=this._startPosition),this.options.delay>0){if(o?e>i:i>e)return;this._isLeftPosition?t.style.left=e+"px":t.style.right=e+"px",setTimeout(function(t){var n=o?e+10:e-10;e.indexOf("%")+1&&(n+="%"),t._animate(t._menu,n,i,o)},this.options.delay,this)}else this._isLeftPosition?t.style.left=i+"px":t.style.right=i+"px",this._map.getSize().x===-i&&(this._isLeftPosition?t.style.left="-100%":t.style.right="100%")}}),L.control.slideMenu=function(t,e){return new L.Control.SlideMenu(t,e)},L.Control.RSWEIndoor=L.Control.extend({options:{position:"topleft",contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(t){this._map.panTo(t.latlng)}}],layers:[],roomProps:[],roomWallsProps:[],controlLayerGrp:{},drawnWallsLayerGrp:{},labelsLayerGrp:{},fitBondsAfterLoad:!0,showSizeArrows:!0,dontShowSmallSizeLabels:.5,showSquareLabels:!0,dontShowSquaresLessThan:1,considerWallThikness:!0,wallWidth:.1,pixelsPerMeter:100,snapOptions:{displaySnapGrid:!0,gridStep:.1,snapWallsToGrid:!0,snapWindowsToGrid:!1,snapDoorsToGrid:!1,snapWallsToObjects:!1,snapWindowsToObjects:!0,snapDoorsToObjects:!0,snapLayersArray:[]},dialogs:{optionsDialog:function(){return new L.Control.Dialog.Options},saveDialog:function(){return new L.Control.Dialog.Save},loadDialog:function(){return new L.Control.Dialog.Load},saveSVGDialog:function(){return new L.Control.Dialog.SaveSVG},savePNGDialog:function(){return new L.Control.Dialog.SavePNG},saveJPGDialog:function(){return new L.Control.Dialog.SaveJPG}}},DeleteRoom:function(t){var e,i,o;for(i=0;i<this.options.layers.length&&t!==this.options.layers[i].controlLayer;i++);for(o=0;o<this.options.roomWallsProps[i].length;o++)delete this.options.roomWallsProps[i][o];for(o=0;o<this.options.layers[i].roomWalls.length;o++)e=this.options.layers[i].roomWalls[o],this.options.drawnWallsLayerGrp.removeLayer(L.stamp(e));this.options.labelsLayerGrp.eachLayer(function(e){e.options.relatedToLayer===t&&e._map.RSWEIndoor.options.labelsLayerGrp.removeLayer(L.stamp(e))}),this.options.controlLayerGrp.removeLayer(L.stamp(t)),this.options.layers[i].roomWalls.length=0,this.options.layers.splice(i,1),this.options.roomProps.splice(i,1),this.options.roomWallsProps.splice(i,1);for(var n=0,a=this.options.snapOptions.snapLayersArray.length;a>n;n++)if(L.stamp(t)===L.stamp(this.options.snapOptions.snapLayersArray[n])){this.options.snapOptions.snapLayersArray.splice(n,1);break}},RedrawRoom:function(t,e){var o="undefined";if("square"!==t.options.layerType&&"roomname"!==t.options.layerType){if(t instanceof L.Rectangle?o="rectangle":t instanceof L.Polygon?o="polygon":t instanceof L.Polyline?o="polyline":t instanceof L.Circle?o="circle":t instanceof L.Marker&&(o="marker"),e&&(t.options.layerType=e),"circle"===o)return void this.options.controlLayerGrp.addLayer(t);if("marker"===o)return t.bindPopup("A popup!"),void this.options.controlLayerGrp.addLayer(t);this.options.labelsLayerGrp.eachLayer(function(e){e.options.relatedToLayer===t&&e._map.RSWEIndoor.options.labelsLayerGrp.removeLayer(L.stamp(e))});var n,a,s,r,l,h,p=this.options.dontShowSmallSizeLabels,d=0,c=0;for(d=0;d<this.options.layers.length;d++)if(t===this.options.layers[d].controlLayer){for(s=0;s<this.options.layers[d].roomWalls.length;s++)n=this.options.layers[d].roomWalls[s],this.options.drawnWallsLayerGrp.removeLayer(n._leaflet_id);this.options.layers[d].roomWalls.length=0;break}var u,g,_,m,f,y,v,b,w,T,S,E,C,k,x,M,D,P,I,W,O,G,z,R,U,N,A,H,F,B,j,Y,q,V,X,J,Z,K,Q,$,tt,et,it,ot,nt,at,st,rt,lt,ht,pt,dt,ct,ut,gt,Lt,_t,mt,ft,yt,vt,bt,wt,Tt,St,Et,Ct,kt,xt,Mt=t._latlngs,Dt=Mt.length,Pt=function(t,e){return function(i){new L.WallToolbarPopup(t,e,i.latlng).addTo(map,a)}},It=function(t){return function(e){new L.SquareToolbarPopup(t,e.latlng).addTo(map,a)}};if(Mt.length>1){for(s=0,Dt=Mt.length;Dt>s;s++)x=new L.LatLng(Mt[s%Dt].lat,Mt[s%Dt].lng),M=new L.LatLng(Mt[(s+1)%Dt].lat,Mt[(s+1)%Dt].lng),y=M.distanceTo(x),x=i,M=i,Math.abs(y)<1e-12&&(Mt.splice(),Mt.splice(s+1,1),s--,Dt--);for(wt=new L.LatLng(0,0),Tt=0,s=0;Dt-1>=s;s++)Tt+=.5*(Mt[(s+1)%Dt].lng*Mt[s%Dt].lat-Mt[s%Dt].lng*Mt[(s+1)%Dt].lat)*6378137*6378137*Math.PI*Math.PI/(180*Math.cos(Mt[s%Dt].lat*Math.PI/180)*180),wt.lat+=Mt[s%Dt].lat/Dt,wt.lng+=Mt[s%Dt].lng/Dt;for(r=[],c=0;Dt>c;c++)this.options.layers[d]===i&&(this.options.layers[d]={}),this.options.roomProps[d]===i&&this.options.roomProps.push({}),h=this.options.roomProps[d],h.layerClass=o,h.layerClassOptions=t.options,h.layerLatlngs=t.getLatLngs(),this.options.roomWallsProps[d]===i&&this.options.roomWallsProps.push([]),l=this.options.roomWallsProps[d],l[c]||(l[c]={}),l[c]={wallType:l[c].wallType?l[c].wallType:"wall",wallWidth:l[c].wallWidth?l[c].wallWidth:this.options.wallWidth},"rectangle"===e&&(l[c].wallType="rectangle"),"wall"===e&&(l[c].wallType="wall"),"window"===e&&(l[c].wallType="window"),"door"===e&&(l[c].wallType="door1");for(s=0,Dt=Mt.length;Dt>s;s++){c=s,u=0,g=100,_=l[s].wallType,m=.5*l[s].wallWidth;var Wt=.5*l[(s+Dt-1)%Dt].wallWidth,Ot=.5*l[s%Dt].wallWidth,Gt=.5*l[(s+1)%Dt].wallWidth;if(x=new L.LatLng(Mt[s%Dt].lat,Mt[s%Dt].lng),M=new L.LatLng(Mt[(s+1)%Dt].lat,Mt[(s+1)%Dt].lng),!(s>Dt-2&&"polyline"===o||s===Dt&&"rectangle"===o)){k=0===s&&"polyline"===o?new L.LatLng(x.lat+x.lat-M.lat,x.lng+x.lng-M.lng):new L.LatLng(Mt[(s-1+Dt)%Dt].lat,Mt[(s-1+Dt)%Dt].lng),D=s===Dt-2&&"polyline"===o?new L.LatLng(M.lat+M.lat-x.lat,M.lng+M.lng-x.lng):new L.LatLng(Mt[(s+2)%Dt].lat,Mt[(s+2)%Dt].lng),E=Math.cos(x.lat*Math.PI/180),C=Math.cos(M.lat*Math.PI/180),f=k.distanceTo(x),y=M.distanceTo(x),v=M.distanceTo(D),P=new L.LatLng(x.lat+(M.lng-x.lng)*(Ot/y*E),x.lng-(M.lat-x.lat)*(Ot/y/E)),I=new L.LatLng(x.lat-(M.lng-x.lng)*(Ot/y*E),x.lng+(M.lat-x.lat)*(Ot/y/E)),W=new L.LatLng(M.lat+(M.lng-x.lng)*(Ot/y*C),M.lng-(M.lat-x.lat)*(Ot/y/C)),O=new L.LatLng(M.lat-(M.lng-x.lng)*(Ot/y*C),M.lng+(M.lat-x.lat)*(Ot/y/C)),W=new L.LatLng(M.lat+(M.lng-x.lng)*(Ot/y*C),M.lng-(M.lat-x.lat)*(Ot/y/C)),O=new L.LatLng(M.lat-(M.lng-x.lng)*(Ot/y*C),M.lng+(M.lat-x.lat)*(Ot/y/C)),G=new L.LatLng(D.lat+(D.lng-M.lng)*(Gt/v*C),D.lng-(D.lat-M.lat)*(Gt/v/C)),z=new L.LatLng(D.lat-(D.lng-M.lng)*(Gt/v*C),D.lng+(D.lat-M.lat)*(Gt/v/C)),R=new L.LatLng(k.lat+(x.lng-k.lng)*(Wt/f*E),k.lng-(x.lat-k.lat)*(Wt/f/E)),U=new L.LatLng(k.lat-(x.lng-k.lng)*(Wt/f*E),k.lng+(x.lat-k.lat)*(Wt/f/E)),V=new L.LatLng(x.lat+(x.lng-k.lng)*(Wt/f*E),x.lng-(x.lat-k.lat)*(Wt/f/E)),X=new L.LatLng(x.lat-(x.lng-k.lng)*(Wt/f*E),x.lng+(x.lat-k.lat)*(Wt/f/E)),J=new L.LatLng(M.lat+(D.lng-M.lng)*(Gt/v*C),M.lng-(D.lat-M.lat)*(Gt/v/C)),Z=new L.LatLng(M.lat-(D.lng-M.lng)*(Gt/v*C),M.lng+(D.lat-M.lat)*(Gt/v/C)),w=(M.lng-x.lng)*(D.lat-M.lat)-(D.lng-M.lng)*(M.lat-x.lat),T=(J.lng-W.lng)*(D.lat-M.lat)-(D.lng-M.lng)*(J.lat-W.lat),Math.abs(w)>1e-12?(F=new L.LatLng(T/w*(M.lat-x.lat)+W.lat,T/w*(M.lng-x.lng)+W.lng),S=Math.max(Ot,Gt),Y=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(W.lat-(M.lat-x.lat)*S/y,W.lng-(M.lng-x.lng)*S/y),new L.LatLng(W.lat+(M.lat-x.lat)*S/y,W.lng+(M.lng-x.lng)*S/y)),$=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(J.lat+(D.lat-M.lat)*S/v,J.lng+(D.lng-M.lng)*S/v),new L.LatLng(J.lat-(D.lat-M.lat)*S/v,J.lng-(D.lng-M.lng)*S/v))):(Y=new L.LatLng(W.lat,W.lng),$=new L.LatLng(J.lat,J.lng)),at=new L.LatLng(Y.lat+.5*(O.lat-W.lat),Y.lng+.5*(O.lng-W.lng)),w=(M.lng-x.lng)*(D.lat-M.lat)-(D.lng-M.lng)*(M.lat-x.lat),T=(Z.lng-O.lng)*(D.lat-M.lat)-(D.lng-M.lng)*(Z.lat-O.lat),Math.abs(w)>1e-12?(H=new L.LatLng(T/w*(M.lat-x.lat)+O.lat,T/w*(M.lng-x.lng)+O.lng),S=Math.max(Ot,Gt),q=L.GeometryUtil.closestOnSegment(map,H,new L.LatLng(O.lat-(M.lat-x.lat)*S/y,O.lng-(M.lng-x.lng)*S/y),new L.LatLng(O.lat+(M.lat-x.lat)*S/y,O.lng+(M.lng-x.lng)*S/y)),tt=L.GeometryUtil.closestOnSegment(map,H,new L.LatLng(Z.lat+(D.lat-M.lat)*S/v,Z.lng+(D.lng-M.lng)*S/v),new L.LatLng(Z.lat-(D.lat-M.lat)*S/v,Z.lng-(D.lng-M.lng)*S/v))):(q=new L.LatLng(O.lat,O.lng),tt=new L.LatLng(Z.lat,Z.lng)),st=new L.LatLng(q.lat-.5*(O.lat-W.lat),q.lng-.5*(O.lng-W.lng)),w=(x.lng-k.lng)*(M.lat-x.lat)-(M.lng-x.lng)*(x.lat-k.lat),T=(P.lng-V.lng)*(M.lat-x.lat)-(M.lng-x.lng)*(P.lat-V.lat),Math.abs(w)>1e-12?(A=new L.LatLng(T/w*(x.lat-k.lat)+V.lat,T/w*(x.lng-k.lng)+V.lng),S=Math.max(Ot,Wt),B=L.GeometryUtil.closestOnSegment(map,A,new L.LatLng(P.lat+(M.lat-x.lat)*S/y,P.lng+(M.lng-x.lng)*S/y),new L.LatLng(P.lat-(M.lat-x.lat)*S/y,P.lng-(M.lng-x.lng)*S/y)),K=L.GeometryUtil.closestOnSegment(map,A,new L.LatLng(V.lat+(k.lat-x.lat)*S/f,V.lng+(k.lng-x.lng)*S/f),new L.LatLng(V.lat-(k.lat-x.lat)*S/f,V.lng-(k.lng-x.lng)*S/f))):(B=new L.LatLng(P.lat,P.lng),K=new L.LatLng(V.lat,V.lng)),ot=new L.LatLng(B.lat+.5*(I.lat-P.lat),B.lng+.5*(I.lng-P.lng)),w=(x.lng-k.lng)*(M.lat-x.lat)-(M.lng-x.lng)*(x.lat-k.lat),T=(I.lng-X.lng)*(M.lat-x.lat)-(M.lng-x.lng)*(I.lat-X.lat),Math.abs(w)>1e-12?(N=new L.LatLng(T/w*(x.lat-k.lat)+X.lat,T/w*(x.lng-k.lng)+X.lng),S=Math.max(Ot,Wt),j=L.GeometryUtil.closestOnSegment(map,N,new L.LatLng(I.lat+(M.lat-x.lat)*S/y,I.lng+(M.lng-x.lng)*S/y),new L.LatLng(I.lat-(M.lat-x.lat)*S/y,I.lng-(M.lng-x.lng)*S/y)),Q=L.GeometryUtil.closestOnSegment(map,N,new L.LatLng(X.lat+(k.lat-x.lat)*S/f,X.lng+(k.lng-x.lng)*S/f),new L.LatLng(X.lat-(k.lat-x.lat)*S/f,X.lng-(k.lng-x.lng)*S/f))):(j=new L.LatLng(I.lat,I.lng),Q=new L.LatLng(X.lat,X.lng)),nt=new L.LatLng(j.lat+.5*(P.lat-I.lat),j.lng+.5*(P.lng-I.lng)),rt=new L.LatLng(x.lat*(1-.01*u)+.01*M.lat*u,x.lng*(1-.01*u)+M.lng*u*.01),lt=new L.LatLng(x.lat*(1-.01*g)+.01*M.lat*g,x.lng*(1-.01*g)+.01*M.lng*g),ht=new L.LatLng(P.lat*(1-.01*u)+.01*W.lat*u,P.lng*(1-.01*u)+W.lng*u*.01),pt=new L.LatLng(I.lat*(1-.01*u)+.01*O.lat*u,I.lng*(1-.01*u)+.01*O.lng*u),dt=new L.LatLng(P.lat*(1-.01*g)+.01*W.lat*g,P.lng*(1-.01*g)+.01*W.lng*g),ct=new L.LatLng(I.lat*(1-.01*g)+.01*O.lat*g,I.lng*(1-.01*g)+.01*O.lng*g),gt=new L.LatLng(rt.lat+(lt.lng-rt.lng)*(.5*E),rt.lng-(lt.lat-rt.lat)*(.5/E)),Lt=new L.LatLng(rt.lat-(lt.lng-rt.lng)*(.5*E),rt.lng+(lt.lat-rt.lat)*(.5/E)),mt=new L.LatLng(lt.lat+(lt.lng-rt.lng)*(.5*C),lt.lng-(lt.lat-rt.lat)*(.5/C)),ft=new L.LatLng(lt.lat-(lt.lng-rt.lng)*(.5*C),lt.lng+(lt.lat-rt.lat)*(.5/C)),ut=new L.LatLng(rt.lat+(lt.lng-rt.lng)*(.5*Math.sqrt(3))*E+.5*(lt.lat-rt.lat),rt.lng-(lt.lat-rt.lat)*(.5*Math.sqrt(3)/E)+.5*(lt.lng-rt.lng)),_t=new L.LatLng(rt.lat-(lt.lng-rt.lng)*(.5*Math.sqrt(3))*E+.5*(lt.lat-rt.lat),rt.lng+(lt.lat-rt.lat)*(.5*Math.sqrt(3)/E)+.5*(lt.lng-rt.lng)),et=L.GeometryUtil.closestOnSegment(map,x,x,M),it=L.GeometryUtil.closestOnSegment(map,M,x,M),this._map.RSWEIndoor.options.considerWallThikness&&(et=L.GeometryUtil.closestOnSegment(map,ot,new L.LatLng(et.lat,et.lng),it),et=L.GeometryUtil.closestOnSegment(map,nt,new L.LatLng(et.lat,et.lng),it),it=L.GeometryUtil.closestOnSegment(map,at,et,new L.LatLng(it.lat,it.lng)),it=L.GeometryUtil.closestOnSegment(map,st,et,new L.LatLng(it.lat,it.lng))),yt=new L.LatLng(.5*(x.lat+M.lat),.5*(x.lng+M.lng)),vt=new L.LatLng(yt.lat+(M.lng-x.lng)*(.5*(this.options.wallWidth/y)*E),yt.lng-(M.lat-x.lat)*(.5*(this.options.wallWidth/y)/E)),bt=new L.LatLng(yt.lat-(M.lng-x.lng)*(.5*(this.options.wallWidth/y)*E),yt.lng+(M.lat-x.lat)*(.5*(this.options.wallWidth/y)/E)),ot=new L.LatLng(et.lat+(bt.lng-vt.lng)*(.5*Math.sqrt(3))*E+.25*(bt.lat-vt.lat),et.lng-(bt.lat-vt.lat)*(.5*Math.sqrt(3)/E)+.25*(bt.lng-vt.lng)),nt=new L.LatLng(et.lat-(vt.lng-bt.lng)*(.5*Math.sqrt(3))*E+.25*(vt.lat-bt.lat),et.lng+(vt.lat-bt.lat)*(.5*Math.sqrt(3)/E)+.25*(vt.lng-bt.lng)),at=new L.LatLng(it.lat-(bt.lng-vt.lng)*(.5*Math.sqrt(3))*E-.25*(bt.lat-vt.lat),it.lng+(bt.lat-vt.lat)*(.5*Math.sqrt(3)/E)-.25*(bt.lng-vt.lng)),st=new L.LatLng(it.lat+(vt.lng-bt.lng)*(.5*Math.sqrt(3))*E-.25*(vt.lat-bt.lat),it.lng-(vt.lat-bt.lat)*(.5*Math.sqrt(3)/E)-.25*(vt.lng-bt.lng)),this.options.controlLayerGrp.addLayer(t);for(var zt=0,Rt=this.options.snapOptions.snapLayersArray.length;Rt>zt&&L.stamp(t)!==L.stamp(this.options.snapOptions.snapLayersArray[zt]);zt++);zt===Rt&&this.options.snapOptions.snapLayersArray.push(t),"wall"===_?(this._map.RSWEIndoor.options.showSizeArrows&&(b=it.distanceTo(et),b>p&&(n=new L.Polyline([et,it],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ot,nt,et],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([at,st,it],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=vt.lat>bt.lat?new L.ScalableText(" "+(b+1e-4).toFixed(2)+" m ",bt,vt).addTo(map):new L.ScalableText(" "+(b+1e-4).toFixed(2)+" m ",vt,bt).addTo(map),n.options.layerType="size-text",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n))),n=new L.Polygon([x,B,Y,M,q,j],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,K,B,x,Q,j],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,$,Y,M,tt,q],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a),r.push(a)):"gap"===_?(n=new L.Polygon([I,pt,ht,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a),r.push(a)):"window"===_?(n=new L.Polygon([P,ht,pt,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{fillColor:"#ffffff",color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[ht.lat,ht.lng],"L",[dt.lat,dt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[pt.lat,pt.lng],"L",[ct.lat,ct.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[rt.lat,rt.lng],"L",[lt.lat,lt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a),r.push(a)):"door1"===_?(n=new L.Polygon([P,ht,pt,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[rt.lat,rt.lng],"L",[ut.lat,ut.lng],"Q",[mt.lat,mt.lng],[lt.lat,lt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a),r.push(a)):"door2"===_?(n=new L.Polygon([P,ht,pt,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),
r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[rt.lat,rt.lng],"L",[_t.lat,_t.lng],"Q",[ft.lat,ft.lng],[lt.lat,lt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a),r.push(a)):"door3"===_?(n=new L.Polygon([P,ht,pt,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[lt.lat,lt.lng],"L",[ut.lat,ut.lng],"Q",[gt.lat,gt.lng],[rt.lat,rt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(a),a.options.layerType="control",r.push(a)):"door4"===_?(n=new L.Polygon([P,ht,pt,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([O,ct,dt,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,Y,W],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([M,q,O],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,B,P],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([x,j,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Polygon([ht,pt,ct,dt],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[lt.lat,lt.lng],"L",[_t.lat,_t.lng],"Q",[Lt.lat,Lt.lng],[rt.lat,rt.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),a=new L.Polygon([P,W,O,I],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),a.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(a)):"rectangle"===_&&(n=new L.Polygon([x,M,wt],{fillColor:"#ffffff",color:"#ffffff",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[x.lat,x.lng],"L",[M.lat,M.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n),n=new L.Curve(["M",[(x.lat+wt.lat)/2,(x.lng+wt.lng)/2],"Q",[(8*x.lat+8*M.lat+1*wt.lat)/17,(8*x.lng+8*M.lng+1*wt.lng)/17],[(M.lat+wt.lat)/2,(M.lng+wt.lng)/2]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),n.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(n),r.push(n)),a&&a.on("contextmenu",Pt(d,c),this)}}this.options.roomWallsProps[d]=l,this.options.roomProps[d]=h,this.options.layers[d]={controlLayer:t,roomWalls:r},this.options.roomProps[d].freezeSquare||this.calcRoomSquare(d),this.options.roomProps[d].freezeLabel&&(St=new L.LatLng(parseFloat(this.options.roomProps[d].bindLabelPoint.lat),parseFloat(this.options.roomProps[d].bindLabelPoint.lng))),St||(St=L.LatLngUtil.cloneLatLng(wt)),Et=new L.LatLng(St.lat+.01,St.lng),b=St.distanceTo(Et),Et.lat=St.lat+2*(Et.lat-St.lat)*(this.options.wallWidth/b),Et.lng=St.lng+2*(Et.lng-St.lng)*(this.options.wallWidth/b),Ct=new L.LatLng(St.lat-(Et.lat-St.lat),St.lng-(Et.lng-St.lng)),this.options.roomProps[d].roomName&&this.options.roomProps[d].roomName.length>0&&(kt=new L.ScalableText(this.options.roomProps[d].roomName,L.LatLngUtil.cloneLatLng(St),L.LatLngUtil.cloneLatLng(Et),{bgColor:"transparent",attributes:{fill:"white"},editable:!0,onDrag:function(e,i){this._scalabletext._map.RSWEIndoor.options.roomProps[d].freezeLabel=!0,this._scalabletext._map.RSWEIndoor.options.labelsLayerGrp.eachLayer(function(e){e.options.relatedToLayer===t&&(e._latlngs[0].lat+=parseFloat(i.lat),e._latlngs[0].lng+=parseFloat(i.lng),e._latlngs[1].lat+=parseFloat(i.lat),e._latlngs[1].lng+=parseFloat(i.lng),e.redraw())}),this._scalabletext._map.RSWEIndoor.options.roomProps[d].freezeLabel=!0,this._scalabletext._map.RSWEIndoor.options.roomProps[d].bindLabelPoint=L.LatLngUtil.cloneLatLng(e._latlng)}}).addTo(map),kt.options.layerType="roomname",kt.options.relatedToLayer=t,this.options.controlLayerGrp.addLayer(kt),this.options.labelsLayerGrp.addLayer(kt),kt.on("contextmenu",It(d),this)),this._map.RSWEIndoor.options.showSquareLabels&&(Tt=this.options.roomProps[d].roomSquare,"wall"===t.options.layerType&&(Tt>this._map.RSWEIndoor.options.dontShowSquaresLessThan||this.options.roomProps[d].freezeSquare)&&(this.options.roomProps[d].hideSquare||(xt=new L.ScalableText(" "+(Number(Tt)+1e-4).toFixed(1)+" mÂ² ",L.LatLngUtil.cloneLatLng(Ct),L.LatLngUtil.cloneLatLng(St),{bgColor:"transparent",attributes:{fill:"white"},editable:kt?!1:!0,markerOnTop:!0,onDrag:function(e,i){this._scalabletext._map.RSWEIndoor.options.roomProps[d].freezeLabel=!0,this._scalabletext._map.RSWEIndoor.options.labelsLayerGrp.eachLayer(function(e){e.options.relatedToLayer===t&&(e._latlngs[0].lat+=parseFloat(i.lat),e._latlngs[0].lng+=parseFloat(i.lng),e._latlngs[1].lat+=parseFloat(i.lat),e._latlngs[1].lng+=parseFloat(i.lng),e.redraw())}),this._scalabletext._map.RSWEIndoor.options.roomProps[d].freezeLabel=!0,this._scalabletext._map.RSWEIndoor.options.roomProps[d].bindLabelPoint=L.LatLngUtil.cloneLatLng(e._latlng)}}).addTo(map),xt.options.layerType="square",xt.options.relatedToLayer=t,this.options.controlLayerGrp.addLayer(xt),this.options.labelsLayerGrp.addLayer(xt),xt.on("contextmenu",It(d),this))))}this.options.controlLayerGrp.bringToBack(),this.options.drawnWallsLayerGrp.eachLayer(function(t){"square"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"rectangle"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"wall"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"size-arrows"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"size-text"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"window"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"door"===t.options.layerType&&t.bringToFront()}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"control"===t.options.layerType&&t.bringToFront()})}},ChangeWallType:function(t,e){if(this.options.layers[t].controlLayer&&this.options.roomWallsProps[t]){var i=this.options.roomWallsProps[t];if("wall"===i[e].wallType)i[e].wallType="gap";else if("gap"===i[e].wallType)i[e].wallType="wall";else if("door1"===i[e].wallType)i[e].wallType="door2";else if("door2"===i[e].wallType)i[e].wallType="door4";else if("door4"===i[e].wallType)i[e].wallType="door3";else{if("door3"!==i[e].wallType)return;i[e].wallType="door1"}this.RedrawRoom(this.options.layers[t].controlLayer)}},SetSnapOptions:function(){this._map.drawControl.setDrawingOptions({wall:{snapType:"wall",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWallsToGrid,snapToObjects:this.options.snapOptions.snapWallsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},window:{snapType:"window",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWindowsToGrid,snapToObjects:this.options.snapOptions.snapWindowsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},door:{snapType:"door",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapDoorsToGrid,snapToObjects:this.options.snapOptions.snapDoorsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6}})},showAllSquareLabels:function(){for(var t=0,e=this.options.roomProps.length;e>t;t++)this.options.roomProps[t].hideSquare=!1;this._map.fire("redraw:all")},calcRoomSquare:function(t){if(this.options.layers[t].controlLayer){var e,i=this.options.layers[t].controlLayer;if(i instanceof L.Polygon?e="polygon":i instanceof L.Polyline&&(e="polyline"),e&&i._latlngs){var o=i._latlngs;if(!(o.length<1)){var n=o.length;if(this.options.roomWallsProps[t]){var a=this.options.roomWallsProps[t];if(this.options.roomProps[t]){for(var s,r,l,h=this.options.roomProps[t],p=0,d=0,c=0,u=0;n>u;u++)s=.5*a[(u+n-1)%n].wallWidth,r=.5*a[u%n].wallWidth,l=.5*a[(u+1)%n].wallWidth,0===u&&"polyline"===e&&(s=0),u===n-1&&"polyline"===e&&(l=0),p+=.5*(o[(u+1)%n].lng*o[u%n].lat-o[u%n].lng*o[(u+1)%n].lat)*6378137*6378137*Math.PI*Math.PI/(180*Math.cos(o[u%n].lat*Math.PI/180)*180),(u!==n-1||"polyline"!==e)&&(d+=o[(u+1)%n].distanceTo(o[u%n])*r,c+=.5*(s*r+r*l)/n);h.roomSquare=Math.abs(p)-d+c}}}}}},getPNGData:function(t){var i=new Image;if(i.w=this.getSVGSize().x,i.h=this.getSVGSize().y,0===i.w&&0===i.h)return t("");var o=L.Util.base64Encode(this.getSVGData());i.onload=function(){var o=e.createElement("canvas");o.width=i.w,o.height=i.h;var n=o.getContext("2d");n.beginPath(),n.rect(0,0,i.w,i.h),n.fillStyle="white",n.fill(),n.drawImage(i,0,0);var a=o.toDataURL("image/png");return o=null,t(a.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))},i.src="data:image/svg+xml;base64,"+o},getJPGData:function(t){var i=new Image;if(i.w=this.getSVGSize().x,i.h=this.getSVGSize().y,0===i.w&&0===i.h)return t("");var o=L.Util.base64Encode(this.getSVGData());i.onload=function(){var o=e.createElement("canvas");o.width=i.w,o.height=i.h;var n=o.getContext("2d");n.beginPath(),n.rect(0,0,i.w,i.h),n.fillStyle="white",n.fill(),n.drawImage(i,0,0);var a=o.toDataURL("image/jpeg",1);return o=null,t(a.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))},i.src="data:image/svg+xml;base64,"+o},getSVGSize:function(){var t=!0;for(var e in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(e)){t=!1;break}if(t)return{x:0,y:0};var i=this.options.drawnWallsLayerGrp.getBounds(),o=Math.cos(i.getCenter().lat*Math.PI/180),n=6378137*Math.PI,a=1/this.options.pixelsPerMeter,s=180*a/(n*o),r=180*a/n;return{x:Math.round((i.getEast()-i.getWest())/s+1),y:Math.round((-i.getSouth()+i.getNorth())/r)+1}},getSVGData:function(){var t=!0;for(var e in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(e)){t=!1;break}if(t)return"";var i=this.options.drawnWallsLayerGrp.getBounds(),o=Math.cos(i.getCenter().lat*Math.PI/180),n=6378137*Math.PI,a=1/this.options.pixelsPerMeter,s=180*a/(n*o),r=180*a/n,l=function(t){return Math.round((t-i.getWest())/s)},h=function(t){return Math.round((-t+i.getNorth())/r)},p=this,d="";return d+='<svg width="'+(l(i.getEast())+1)+'" height="'+(h(i.getSouth())+1)+'" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\r\n',this.options.labelsLayerGrp.eachLayer(function(t){"square"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.labelsLayerGrp.eachLayer(function(t){"roomname"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"rectangle"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"wall"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"size-arrows"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"size-text"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"window"===t.options.layerType&&(d+=p.layerToSVG(t))}),this.options.drawnWallsLayerGrp.eachLayer(function(t){"door"===t.options.layerType&&(d+=p.layerToSVG(t))}),d+="</svg>"},layerToSVG:function(t){var e,i,o,n=this.options.drawnWallsLayerGrp.getBounds(),a=Math.cos(n.getCenter().lat*Math.PI/180),s=6378137*Math.PI,r=1/this.options.pixelsPerMeter,l=180*r/(s*a),h=180*r/s,p=function(t){return Math.round((t-n.getWest())/l)},d=function(t){return Math.round((-t+n.getNorth())/h)},c="",u="";if(0!==t.options.opacity&&"control"!==t.options.layerType){var g="",_="";for(var m in t._path.attributes)if(t._path.attributes.hasOwnProperty(m)){var f=t._path.attributes[m].name,y=t._path.attributes[m].value;"fill"===f&&t instanceof L.Polygon&&"door"===t.options.layerType&&(y="#ffffff"),"fill"===f&&t instanceof L.Polygon&&"rectangle"===t.options.layerType&&(y="#dddddd"),"stroke-opacity"===f&&t instanceof L.Polygon&&(y="0"),"class"!==f&&"d"!==f&&(_+=" "+f+'="'+y+'"')}if(t instanceof L.Polygon&&("wall"===t.options.layerType||"window"===t.options.layerType||"door"===t.options.layerType||"rectangle"===t.options.layerType)){for(e=0,i=t._latlngs.length;i>e;e++)o=t._latlngs[e],c+=(e?" L":"M")+p(o.lng)+" "+d(o.lat),u+=(e?" L":"M")+(p(o.lng)+1)+" "+(d(o.lat)+1);return c+=" Z",u+=" Z",g+="<g><path "+_+' d="'+c+'"/></g>\r\n',g+="<g><path "+_+' d="'+u+'"/></g>\r\n'}if(t instanceof L.Polygon&&"size-arrows"===t.options.layerType){for(e=0,i=t._latlngs.length;i>e;e++)o=t._latlngs[e],c+=(e?" L":"M")+p(o.lng)+".5 "+d(o.lat)+".5";return c+=" Z",g+="<g><path "+_+' d="'+c+'"/></g>\r\n'}if(!(t instanceof L.Polygon)&&t instanceof L.Polyline){for(e=0,i=t._latlngs.length;i>e;e++)o=t._latlngs[e],c+=(e?" L":"M")+p(o.lng)+".5 "+d(o.lat)+".5";return g="<g><path "+_+' d="'+c+'"/></g>\r\n'}if(t instanceof L.Curve){var v;for(e=0;e<t._coords.length;e++)if(o=t._coords[e],"string"==typeof o||o instanceof String)v=o,c+=" "+v;else switch(v){case"H":c+=""+d(o[0])+".5 ";break;case"V":c+=p(o[1])+".5 ";break;default:c+=p(o[1])+".5 "+d(o[0])+".5 "}return g="<g><path "+_+' d="'+c+'"/></g>\r\n'}if(t instanceof L.ScalableText){var b=t._textNode.getAttribute("font-size").replace("px",""),w=1,T="",S=t._textNode.getComputedTextLength(),E=Math.cos(t._latlngs[0].lat*Math.PI/180),C=180*Math.atan2(-t._latlngs[0].lat+t._latlngs[1].lat,(t._latlngs[0].lng-t._latlngs[1].lng)*E)/Math.PI-90;return t.options.center&&(T=T+" translate("+-.5*S+")"),"size-text"===t.options.layerType&&(w=1*w,T="translate("+p(t._latlngs[0].lng)+".5 "+d(t._latlngs[0].lat)+".5) scale("+w.toFixed(3)+")  rotate("+C+")",t.options.center&&(T=T+" translate("+-.5*S+")"),g='<g><g transform="'+T+'"><rect x="-2" y="-10" height="10" fill="black" width="'+12*S/b+'"/><text fill="white" text-anchor="start" y="-1" font-size="12px" font-family="Arial">'+t._text+"</text></g></g>\r\n"),"roomname"===t.options.layerType&&(w=16*w/10,T="translate("+p(t._latlngs[0].lng)+".5 "+d(t._latlngs[0].lat)+".5) scale("+w.toFixed(3)+")  rotate("+C+")",t.options.center&&(T=T+" translate("+-.5*S+")"),g='<g><g transform="'+T+'"><text fill="#dddddd" text-anchor="start" y="-5" font-size="18px" font-family="Arial">'+t._text+"</text></g></g>\r\n"),"square"===t.options.layerType&&(w=16*w/10,T="translate("+p(t._latlngs[0].lng)+".5 "+d(t._latlngs[0].lat)+".5) scale("+w.toFixed(3)+")  rotate("+C+")",t.options.center&&(T=T+" translate("+-.5*S+")"),g='<g><g transform="'+T+'"><text fill="#dddddd" text-anchor="start" y="-1" font-size="18px" font-family="Arial">'+t._text+"</text></g></g>\r\n"),g}return g}},getData:function(){var t={roomProps:this.options.roomProps,roomWallsProps:this.options.roomWallsProps};return JSON.stringify(t)},loadData:function(t){t||(t='{"roomProps":[],"roomWallsProps":[]}');var e;try{e=JSON.parse(t)}catch(i){return!1}return this.options.roomProps=[],this.options.roomWallsProps=[],this.options.layers=[],this.options.drawnWallsLayerGrp.clearLayers(),this.options.controlLayerGrp.clearLayers(),this.options.labelsLayerGrp.clearLayers(),this.options.roomProps=e.roomProps,this.options.roomWallsProps=e.roomWallsProps,this.options.roomProps.forEach(function(t){var e;"rectangle"===t.layerClass&&(e=new L.Rectangle(t.layerLatlngs,t.layerClassOptions)),"polyline"===t.layerClass&&(e=new L.Polyline(t.layerLatlngs,t.layerClassOptions)),"polygon"===t.layerClass&&(e=new L.Polygon(t.layerLatlngs,t.layerClassOptions)),e&&(e.addTo(this._map),e.setStyle&&e.setStyle({opacity:0}),this.options.controlLayerGrp.addLayer(e),this.RedrawRoom(e))},this),this.options.fitBondsAfterLoad&&this.fitBounds(),this._map.fire("close_all_dialogs"),!0},fitBounds:function(){var t;this.options.controlLayerGrp.eachLayer(function(e){t=t?t.extend(e.getBounds()):e.getBounds()}),t&&this._map.fitBounds(t)},RSWEinit:function(){var t=this._map;if(!t)throw new Error("Leaflet has not properly initialized");var e;t.doubleClickZoom.disable(),t.RSWEIndoor.options.controlLayerGrp=t.drawControl._toolbars.edit.options.featureGroup,t.RSWEIndoor.options.drawnWallsLayerGrp=new L.FeatureGroup,t.addLayer(t.RSWEIndoor.options.drawnWallsLayerGrp),t.RSWEIndoor.options.labelsLayerGrp=new L.FeatureGroup,t.addLayer(t.RSWEIndoor.options.labelsLayerGrp),t.options.snapGrid.options.interval=t.RSWEIndoor.options.snapOptions.gridStep,t.RSWEIndoor.options.snapOptions.displaySnapGrid?t.options.snapGrid.show():t.options.snapGrid.hide(),t.RSWEIndoor.SetSnapOptions();for(var o in this.options.dialogs)this.options.dialogs[o]=this.options.dialogs[o](),this._map.addControl(this.options.dialogs[o]);t.on("close_all_dialogs",function(){for(var e in this.RSWEIndoor.options.dialogs)this.RSWEIndoor.options.dialogs[e].close(),this.addControl(this.RSWEIndoor.options.dialogs[e]);t.drawControl._toolbars.draw.disable(),t.drawControl._toolbars.edit.disable()}),t.on("draw:drawstart",function(o){e=o.layer,("wall"===o.layerType||"window"===o.layerType||"door"===o.layerType)&&(t.RSWEIndoor.SetSnapOptions(),(e._poly!==i||e._poly.snapediting!==i)&&(e._poly.snapediting=new L.Handler.PolylineSnap(t,e._poly),e._poly.snapediting._snapper._guides=t.RSWEIndoor.options.snapOptions.snapLayersArray,e._poly.snapediting._snapper.options.gridStep=t.RSWEIndoor.options.snapOptions.gridStep,"wall"===o.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWallsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===o.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWindowsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===o.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapDoorsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapDoorsToObjects),e._poly.snapediting.enable()))}),t.on("draw:editstart_after",function(){t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(e){e.setStyle&&e.setStyle({opacity:.6}),e.editing._poly!==i&&e.snapediting===i&&(t.removeLayer(e.editing._markerGroup),e.snapediting=new L.Handler.PolylineSnap(t,e),e.snapediting._snapper._guides=t.RSWEIndoor.options.snapOptions.snapLayersArray,e.snapediting._snapper.options.gridStep=t.RSWEIndoor.options.snapOptions.gridStep,"wall"===e.options.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWallsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===e.options.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWindowsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===e.options.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapDoorsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapDoorsToObjects),e.snapediting.enable())},t)}),t.on("draw:editstop",function(){t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(t){t.setStyle&&t.setStyle({opacity:0}),t.editing._poly!==i&&t.snapediting!==i&&(t.snapediting.disable(),delete t.snapediting),t._mouseMarker&&t._mouseMarker._snapper&&(t._mouseMarker._snapper.disable(),delete t._mouseMarker._snapper)},t)}),t.on("revert-edited",function(e){var i=e.layer;t.RSWEIndoor.RedrawRoom(i)}),t.on("edit",function(e){var i=e.layer;t.RSWEIndoor.RedrawRoom(i)}),t.on("draw:deleted",function(t){var e=t.layers._layers;for(var i in e)this.RSWEIndoor.DeleteRoom(e[i])}),t.on("draw:created",function(e){e.layer.setStyle&&e.layer.setStyle({opacity:0}),t.RSWEIndoor.RedrawRoom(e.layer,e.layerType)}),t.on("redraw:all",function(){t.RSWEIndoor.options.labelsLayerGrp.clearLayers(),t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(e){t.RSWEIndoor.RedrawRoom(e)})}),t.on("redraw:showAllSquareLabels",function(){t.RSWEIndoor.showAllSquareLabels()})}}),L.Map.addInitHook(function(){if(this.options.RSWEIndoor){var t=new L.FeatureGroup;this.addLayer(t),this.drawControl=new L.Control.Draw({edit:{featureGroup:t}}),this.addControl(this.drawControl),this.RSWEIndoor=new L.Control.RSWEIndoor,this.RSWEIndoor._map=this,this.slideMenu=L.control.slideMenu("",{}),this.addControl(this.slideMenu),this.graphicScaleControl=L.control.graphicScale().addTo(this),this.options.simpleGraticule=(new L.simpleGraticule).addTo(this),this.options.snapGrid=(new L.snapGrid).addTo(this),this.RSWEIndoor.RSWEinit()}}),L.CustomToolbar=(L.Layer||L.Class).extend({statics:{baseClass:"leaflet-toolbar"},includes:L.Mixin.Events,options:{className:"",filter:function(){return!0},actions:[]},initialize:function(t){L.setOptions(this,t),this._toolbarType=this.constructor._toolbarClassId},addTo:function(t){return this._arguments=[].slice.call(arguments),t.addLayer(this),this},onAdd:function(t){var e=t._customtoolbars[this._toolbarType];0===this._calculateDepth()&&(e&&t.removeLayer(e),t._customtoolbars[this._toolbarType]=this)},onRemove:function(t){0===this._calculateDepth()&&delete t._customtoolbars[this._toolbarType]},remove:function(){this._map.removeLayer(this)},appendToContainer:function(t){var e,i,o,n,a,s,r=this.constructor.baseClass+"-"+this._calculateDepth(),l=r+" "+this.options.className;for(this._container=t,this._ul=L.DomUtil.create("ul",l,t),this._disabledEvents=["click","mousemove","dblclick"],n=0,s=this._disabledEvents.length;s>n;n++)L.DomEvent.on(this._ul,this._disabledEvents[n],L.DomEvent.stopPropagation);for(o=0,a=this.options.actions.length;a>o;o++)e=this._getActionConstructor(this.options.actions[o]),i=new e,i._createIcon(this,this._ul,this._arguments)},_getActionConstructor:function(t){var e=this._arguments,i=this;return t.extend({initialize:function(){t.prototype.initialize.apply(this,e)},enable:function(e){i._active&&i._active.disable(),i._active=this,t.prototype.enable.call(this,e)}})},_hide:function(){this._ul.style.display="none"},_show:function(){this._ul.style.display="block"},_calculateDepth:function(){for(var t=0,e=this.parentToolbar;e;)t+=1,e=e.parentToolbar;return t}}),L.customtoolbar={};var o=0;L.CustomToolbar.extend=function(t){var e=L.extend({},t.statics,{_toolbarClassId:o});return o+=1,L.extend(t,{statics:e}),L.Class.extend.call(this,t)},L.Map.addInitHook(function(){this._customtoolbars={}}),L.ToolbarAction=L.Handler.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",tooltip:""},isHidden:function(){return!1},separator:!1,subToolbar:new L.CustomToolbar},initialize:function(t){var e=L.ToolbarAction.prototype.options.toolbarIcon;L.setOptions(this,t),this.options.toolbarIcon=L.extend({},e,this.options.toolbarIcon)},enable:function(t){t&&L.DomEvent.preventDefault(t),this._enabled||(this._enabled=!0,this.addHooks&&this.addHooks(),this._map&&this.toolbar&&("function"==typeof this.options.callback&&this.options.callback.call(this,this._map),0===this.options.subToolbar.options.actions.length&&this._map.removeLayer(this.toolbar)))},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(t,e,i){var o=this.options.toolbarIcon;this.toolbar=t,this._map=t._map,this.options.isHidden.call(this,this._map)||(this._icon=L.DomUtil.create("li","",e),this._link=L.DomUtil.create("a","",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.innerHTML="<div>"+o.html+"</div>",this._link.setAttribute("href","#"),this._link.setAttribute("title",o.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),o.className&&L.DomUtil.addClass(this._link,o.className),L.DomEvent.on(this._link,"click",this.enable,this),this._addSubToolbar(t,this._icon,i))},_addSubToolbar:function(t,e,i){var o=this.options.subToolbar,n=this.addHooks,a=this.removeHooks;o.parentToolbar=t,o.options.actions.length>0&&(i=[].slice.call(i),i.push(this),o.addTo.apply(o,i),o.appendToContainer(e),this.addHooks=function(t){"function"==typeof n&&n.call(this,t),o._show()},this.removeHooks=function(t){"function"==typeof a&&a.call(this,t),o._hide()})}}),L.ToolbarAction.extendOptions=function(t){return this.extend({options:t})},L.ToolbarActionInput=L.ToolbarAction.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",tooltip:""},isHidden:function(){return!1},separator:!1,placeholder:"",setInitValue:function(){return""}},enable:function(t){var e=!1;t&&L.DomEvent.preventDefault(t),this._enabled||(this._enabled=!0,this.addHooks&&this.addHooks(),this._map&&this.toolbar&&("function"==typeof this.options.callback&&(e=this.options.callback.call(this,this._map,this._input)),e&&this._map.removeLayer(this.toolbar)))},enableOnEnter:function(t){13===t.which&&(this._input.blur(),this.enable(t))},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(t,e){var i=this.options.toolbarIcon;this.toolbar=t,this._map=t._map,this.options.isHidden.call(this,this._map)||(this._icon=L.DomUtil.create("li","",e),this._link=L.DomUtil.create("a","leaflet-toolbar-icon-input",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.setAttribute("href","#"),this._link.setAttribute("title",i.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),i.className&&L.DomUtil.addClass(this._link,i.className),L.DomEvent.on(this._link,"click",this.enable,this),this._div=L.DomUtil.create("div","leaflet-toolbar-div-input",this._icon),this.options.separator&&L.DomUtil.addClass(this._div,"leaflet-toolbar-icon-separator"),this._input=L.DomUtil.create("input","",this._div),this._input.setAttribute("onclick","this.select();"),L.DomEvent.on(this._input,"keypress",this.enableOnEnter,this),this._input.setAttribute("type","text"),"function"==typeof this.options.setInitValue&&this._input.setAttribute("value",this.options.setInitValue.call(this,this._map,this._input)),this.options.placeholder&&this._input.setAttribute("placeholder",this.options.placeholder))}}),L.ToolbarActionInput.extendOptions=function(t){return this.extend({options:t})},L.ToolbarActionLabel=L.ToolbarAction.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",tooltip:""},isHidden:function(){return!1},separator:!1,label:""},enable:function(t){t&&L.DomEvent.preventDefault(t),this._enabled=!1},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(t,e){var i=this.options.toolbarIcon;this.toolbar=t,this._map=t._map,this.options.isHidden.call(this,this._map)||(this._icon=L.DomUtil.create("li","",e),this._link=L.DomUtil.create("a","leaflet-toolbar-noicon leaflet-toolbar-label",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.setAttribute("href","#"),this._link.setAttribute("title",i.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),i.className&&L.DomUtil.addClass(this._link,i.className),L.DomEvent.on(this._link,"click",this.enable,this),this._div=L.DomUtil.create("div","leaflet-toolbar-div-label",this._link),this.options.label&&(this._div.innerHTML=this.options.label))}}),L.ToolbarActionLabel.extendOptions=function(t){return this.extend({options:t})},L.ToolbarPopup=L.CustomToolbar.extend({statics:{baseClass:"leaflet-popup-toolbar "+L.CustomToolbar.baseClass},options:{anchor:[0,0]},initialize:function(t,e){L.CustomToolbar.prototype.initialize.call(this,e),this._marker=new L.Marker(t,{icon:new L.DivIcon({className:this.options.className,iconSize:[0,0],iconAnchor:[0,0]})})},onAdd:function(t){this._map=t,this._marker.addTo(t),this._map.fire("popups:hide",{caller:this}),L.CustomToolbar.prototype.onAdd.call(this,t),this.appendToContainer(this._marker._icon),this._setStyles(),L.DomEvent.on(this._map.getContainer(),"mouseleave",this.remove,this),L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop),this._map.on({mousedown:this.remove,click:this.remove,movestart:this.remove,zoomstart:this.remove},this),this._map.on({"popups:hide":this._onPopupsHide},this)},_onPopupsHide:function(t){t.caller&&t.caller!==this&&this.remove()},onRemove:function(t){L.DomEvent.off(this._container,"click",L.DomEvent.stop).off(this._container,"mousedown",L.DomEvent.stop).off(this._container,"dblclick",L.DomEvent.stop).off(this._container,"contextmenu",L.DomEvent.stop),L.DomEvent.off(this._map.getContainer(),"mouseleave",this.remove,this),this._map.off({mousedown:this.remove,click:this.remove,movestart:this.remove,zoomstart:this.remove},this),this._map.off({"popups:hide":this._onPopupsHide},this),t.removeLayer(this._marker),L.CustomToolbar.prototype.onRemove.call(this,t),delete this._map},setLatLng:function(t){return this._marker.setLatLng(t),this},_setStyles:function(){for(var t,e,i,o=this._container,n=this._ul,a=L.point(this.options.anchor),s=n.querySelectorAll(".leaflet-toolbar-icon"),r=[],l=[],h=0,p=0,d=s.length;d>p;p++)s[p].parentNode.parentNode===n&&(r.push(parseInt(L.DomUtil.getStyle(s[p],"height"),10)),l.push(parseInt(L.DomUtil.getStyle(s[p],"width"),10)));h=l.reduce(function(t,e){return Math.max(t,e)},0),t=r.reduce(function(t,e){return t+e},0),n.style.width=h+"px",this._tipContainer=L.DomUtil.create("div","leaflet-toolbar-tip-container",o),this._tipContainer.style.width=h+"px",
this._tip=L.DomUtil.create("div","leaflet-toolbar-tip",this._tipContainer),e=parseInt(L.DomUtil.getStyle(this._tip,"width"),10),i=new L.Point(0,.7071*e),o.style.marginLeft=a.x-i.x+"px",o.style.marginTop=a.y-i.y+"px"}}),L.SquareToolbarPopup=L.ToolbarPopup.extend({options:{className:"leaflet-draw-toolbar",actions:[L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},setInitValue:function(t){var e=t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomName;return e?e:""},separator:!0,placeholder:"Room name",callback:function(t,e){var i=e.value;return i.length<=20?(t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomName=i,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer),!0):(e.value=i?i.substr(0,20):"",e.select(),!1)}}),L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},isHidden:function(t){return t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},setInitValue:function(t){return Number(t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare).toFixed(1)},placeholder:"Enter decimal",callback:function(t,e){var i=e.value.replace(new RegExp(",","g"),".");return isNaN(i)?(e.value=Number(Number(t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare).toFixed(1)),e.select(),!1):(t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare=Number(Number(i).toFixed(1)),t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeSquare=!0,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer),!0)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Recalculate",className:"leaflet-toolbar-noicon"},isHidden:function(t){return t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},callback:function(t){t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeLabel=!1,t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeSquare=!1,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Hide square",className:"leaflet-toolbar-noicon"},isHidden:function(t){return t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},callback:function(t){t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare=!0,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Show square",className:"leaflet-toolbar-noicon"},isHidden:function(t){return t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!1:!0},callback:function(t){t.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare=!1,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}})]},initialize:function(t,e,i){this.options.roomId=t,L.setOptions(this,i),L.ToolbarPopup.prototype.initialize.call(this,e,i)}}),L.WallToolbarPopup=L.ToolbarPopup.extend({options:{className:"leaflet-draw-toolbar",actions:[L.ToolbarActionLabel.extendOptions({toolbarIcon:{html:"",className:"leaflet-toolbar-noicon"},label:"Wall width (cm):"}),L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},setInitValue:function(t){var e=this.toolbar.options.roomId,i=this.toolbar.options.wallId;return parseInt(100*t.RSWEIndoor.options.roomWallsProps[e][i].wallWidth,10)},separator:!0,placeholder:"Wall width",callback:function(t,e){var i=this.toolbar.options.roomId,o=this.toolbar.options.wallId,n=t.RSWEIndoor.options.roomWallsProps[i][o].wallWidth,a=parseInt(e.value,10);return!isNaN(a)&&a>0&&101>a?(t.RSWEIndoor.options.roomWallsProps[i][o].wallWidth=.01*a,t.RSWEIndoor.RedrawRoom(t.RSWEIndoor.options.layers[i].controlLayer),!0):void(e.value=parseInt(100*n,10))}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Hide wall",className:"leaflet-toolbar-noicon"},isHidden:function(t){var e=this.toolbar.options.roomId,i=this.toolbar.options.wallId,o=t.RSWEIndoor.options.roomWallsProps[e][i].wallType;return"wall"===o?!1:!0},callback:function(t){t.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Show wall",className:"leaflet-toolbar-noicon"},isHidden:function(t){var e=this.toolbar.options.roomId,i=this.toolbar.options.wallId,o=t.RSWEIndoor.options.roomWallsProps[e][i].wallType;return"gap"===o?!1:!0},callback:function(t){t.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Rotate",className:"leaflet-toolbar-noicon"},isHidden:function(t){var e=this.toolbar.options.roomId,i=this.toolbar.options.wallId,o=t.RSWEIndoor.options.roomWallsProps[e][i].wallType;return"door1"===o||"door2"===o||"door3"===o||"door4"===o?!1:!0},callback:function(t){return t.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId),!0}})]},initialize:function(t,e,i,o){this.options.roomId=t,this.options.wallId=e,L.setOptions(this,o),L.ToolbarPopup.prototype.initialize.call(this,i,o)}}),L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},initialize:function(t){L.setOptions(this,t),this._attributions={}},onAdd:function(t){return this._initLayout(),this._map=t,this.update(),this.options.initOpen||this.close(),this._container},open:function(){return this._map?(this._container.style.visibility="",this._map.fire("dialog:opened",this),this):void 0},close:function(){return this._container.style.visibility="hidden",this._map.fire("dialog:closed",this),this},destroy:function(){return this._map?(this.removeFrom(this._map),this.onRemove&&this.onRemove(this._map),this._map.fire("dialog:destroyed",this),this):this},setLocation:function(t){return t=t||[250,250],this.options.anchor[0]=0,this.options.anchor[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._move(t[0],t[1]),this},setSize:function(t){return t=t||[300,300],this.options.size[0]=0,this.options.size[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._resize(t[0],t[1]),this},lock:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._closeNode.style.visibility="hidden",this._map.fire("dialog:locked",this),this},unlock:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._closeNode.style.visibility="",this._map.fire("dialog:unlocked",this),this},freeze:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._map.fire("dialog:frozen",this),this},unfreeze:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._map.fire("dialog:unfrozen",this),this},setContent:function(t){return this._content=t,this.update(),this},getContent:function(){return this._content},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var t="leaflet-control-dialog",e=this._container=L.DomUtil.create("div",t);e.style.width=this.options.size[0]+"px",e.style.height=this.options.size[1]+"px",e.style.left=this.options.anchor[0]+"px",e.style.top=this.options.anchor[1]+"px";var i=L.DomEvent.stopPropagation;L.DomEvent.on(e,"click",i).on(e,"mousedown",i).on(e,"touchstart",i).on(e,"dblclick",i).on(e,"mousewheel",i).on(e,"contextmenu",i).on(e,"MozMousePixelScroll",i);var o=this._innerContainer=L.DomUtil.create("div",t+"-inner"),n=this._grabberNode=L.DomUtil.create("div",t+"-grabber");n.innerHTML="<b>&#8689;</b>",L.DomEvent.on(n,"mousedown",this._handleMoveStart,this);var a=this._closeNode=L.DomUtil.create("div",t+"-close");a.innerHTML="<b>X</b>",L.DomEvent.on(a,"click",this._handleClose,this);var s=this._resizerNode=L.DomUtil.create("div",t+"-resizer");s.innerHTML="<b>&#8690;</b>",L.DomEvent.on(s,"mousedown",this._handleResizeStart,this);var r=this._contentNode=L.DomUtil.create("div",t+"-contents");e.appendChild(o),o.appendChild(r),o.appendChild(n),o.appendChild(a),o.appendChild(s),this._oldMousePos={x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(t){this._oldMousePos.x=t.clientX,this._oldMousePos.y=t.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:resizestart",this),this._resizing=!0},_handleMoveStart:function(t){this._oldMousePos.x=t.clientX,this._oldMousePos.y=t.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:movestart",this),this._moving=!0},_handleMouseMove:function(t){var e=t.originalEvent.clientX-this._oldMousePos.x,i=t.originalEvent.clientY-this._oldMousePos.y;t.originalEvent.stopPropagation&&t.originalEvent.stopPropagation(),t.originalEvent.preventDefault&&t.originalEvent.preventDefault(),this._resizing&&this._resize(e,i),this._moving&&this._move(e,i)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this),this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",this)),this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(t,e){var i=this.options.anchor[0]+t,o=this.options.anchor[1]+e;this.options.anchor[0]=i,this.options.anchor[1]=o,this._container.style.left=this.options.anchor[0]+"px",this._container.style.top=this.options.anchor[1]+"px",this._map.fire("dialog:moving",this),this._oldMousePos.y+=e,this._oldMousePos.x+=t},_resize:function(t,e){var i=this.options.size[0]+t,o=this.options.size[1]+e;i<=this.options.maxSize[0]&&i>=this.options.minSize[0]&&(this.options.size[0]=i,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=t),o<=this.options.maxSize[1]&&o>=this.options.minSize[1]&&(this.options.size[1]=o,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=e),this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px",this._container.style.height=this.options.size[1]+"px",this._container.style.left=this.options.anchor[0]+"px",this._container.style.top=this.options.anchor[1]+"px"}}),L.control.dialog=function(t){return new L.Control.Dialog(t)},L.Control.Dialog.WallProps=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,_innerHTML:{},_curRoomId:0,_curWallId:0,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Wall options</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Wall options</h3></div></div>',"</div>","</div>",""],saveAsText:function(){var t=this.options.saveALink,e="RSWE.json";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this._map.RSWEIndoor.getData();t.href="data:text/plain;base64,"+L.Util.base64Encode(i),t.click(),this.close()},_dlgCreateControls:function(){var t,e;if(t=this._getTabContainer(0)){e=L.DomUtil.create("div","innerHTML"),t.appendChild(e),e.innerHTML=['<label><span> Wall width (cm)</span> <input type="text" name="wallWidth" placeholder="Wall width"/></label>',""].join(""),this._innerHTML=e;var i=e.getElementsByTagName("INPUT")[0];L.DomEvent.addListener(i,"change",this.setWallWidth,this)}},setDlgInputs:function(t,e){return this._curRoomId=t,this._curWallId=e,this._curWallWidth=this._map.RSWEIndoor.options.roomWallsProps[t][this._curWallId].wallWidth,this._innerHTML.getElementsByTagName("INPUT")[0].value=parseInt(100*this._curWallWidth,10),this},setWallWidth:function(t){if(t.target.value){var e=parseInt(t.target.value,10);!isNaN(e)&&e>0&&101>e?(this._map.RSWEIndoor.options.roomWallsProps[this._curRoomId][this._curWallId].wallWidth=.01*e,this.close(),this._map.RSWEIndoor.RedrawRoom(this._map.RSWEIndoor.options.layers[this._curRoomId].controlLayer)):t.target.value=parseInt(100*this._curWallWidth,10)}}}),L.control.dialog.wallprops=function(t){return new L.Control.Dialog.WallProps(t)},L.Control.Dialog.Options=L.Control.Dialog.extend({options:{size:[320,190],minSize:[320,190],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.6*e.x),Math.floor(.6*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">View Options</li>','<li class="dialog-tab-title">Edit Options</li>','<li class="dialog-tab-title">Snap Options</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>View Options</h3></div></div>','<div class="dialog-tab"><div class="dialog-tab-content"><h3>Edit Options</h3></div></div>','<div class="dialog-tab"><div class="dialog-tab-content"><h3>Snap Options</h3></div></div>',"</div>","</div>",""],_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(this._map.options.simpleGraticule!==i&&(e=L.DomUtil.create("div","display-grid-control"),t.appendChild(e),this._map.options.simpleGraticule.options.hidden===!1?e.innerHTML='<label><input type="checkbox" checked name="simpleGraticule" value="1" />Display Measure Grid</label>':e.innerHTML='<label><input type="checkbox" name="simpleGraticule" value="1" />Display Measure Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.options.simpleGraticule.show():this._map.options.simpleGraticule.hide()},this)),this._map.options.graphicScaleControl!==i&&(e=L.DomUtil.create("div","display-graphicscale-control"),t.appendChild(e),"none"===this._map.options.graphicScaleControl.style.display?e.innerHTML='<label><input type="checkbox" name="graphicScaleControl" value="1" />Display Ruler</label>':e.innerHTML='<label><input type="checkbox" checked name="graphicScaleControl" value="1" />Display Ruler</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.options.graphicScaleControl.style.display="block":this._map.options.graphicScaleControl.style.display="none"},this)),this._map.RSWEIndoor.options.fitBondsAfterLoad!==i&&(e=L.DomUtil.create("div","display-fitbonds-control"),t.appendChild(e),this._map.RSWEIndoor.options.fitBondsAfterLoad===!0?e.innerHTML='<label><input type="checkbox" checked name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>':e.innerHTML='<label><input type="checkbox" name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.RSWEIndoor.options.fitBondsAfterLoad=!0:this._map.RSWEIndoor.options.fitBondsAfterLoad=!1},this)),this._map.RSWEIndoor.options.showSizeArrows!==i&&(e=L.DomUtil.create("div","display-showSizeArrows-control"),t.appendChild(e),this._map.RSWEIndoor.options.showSizeArrows===!0?e.innerHTML='<label><input type="checkbox" checked name="showSizeArrows" value="1" />Show Size Arrows</label>':e.innerHTML='<label><input type="checkbox" name="showSizeArrows" value="1" />Show Size Arrows</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.RSWEIndoor.options.showSizeArrows=!0:this._map.RSWEIndoor.options.showSizeArrows=!1,this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.dontShowSmallSizeLabels!==i&&(e=L.DomUtil.create("div","dontShowSmallSizeLabels-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name="dontShowSmallSizeLabels" /> Dont Show Wall Size Labels Smaller Than(meters)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.dontShowSmallSizeLabels),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=t.target.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.dontShowSmallSizeLabels:(this._map.RSWEIndoor.options.dontShowSmallSizeLabels=e,t.target.value=e,this._map.fire("redraw:all"))}},this)),this._map.RSWEIndoor.options.considerWallThikness!==i&&(e=L.DomUtil.create("div","considerWallThikness-control"),t.appendChild(e),this._map.RSWEIndoor.options.considerWallThikness===!0?e.innerHTML='<label><input type="checkbox" checked name="considerWallThikness" value="1" />Consider Wall Thikness</label>':e.innerHTML='<label><input type="checkbox" name="considerWallThikness" value="1" />Consider Wall Thikness</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.RSWEIndoor.options.considerWallThikness=!0:this._map.RSWEIndoor.options.considerWallThikness=!1,this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.showSquareLabels!==i&&(e=L.DomUtil.create("div","display-showSquareLabels-control"),t.appendChild(e),this._map.RSWEIndoor.options.showSquareLabels===!0?e.innerHTML='<label><input type="checkbox" checked name="showSquareLabels" value="1" />Show Square Labels</label>':e.innerHTML='<label><input type="checkbox" name="showSquareLabels" value="1" />Show Square Labels</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.RSWEIndoor.options.showSquareLabels=!0:this._map.RSWEIndoor.options.showSquareLabels=!1,this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.dontShowSquaresLessThan!==i&&(e=L.DomUtil.create("div","dontShowSquaresLessThan-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name="dontShowSquaresLessThan" /> Dont Show Squares Less Than (mÂ²)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.dontShowSquaresLessThan),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=t.target.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.dontShowSquaresLessThan:(this._map.RSWEIndoor.options.dontShowSquaresLessThan=e,t.target.value=e,this._map.fire("redraw:all"))}},this))),t=this._getTabContainer(1),t&&this._map.RSWEIndoor.options.wallWidth!==i&&(e=L.DomUtil.create("div","wallwidth-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name="wallWidthControl" /> Wall Width (meters)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.wallWidth),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=t.target.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.wallWidth:(this._map.RSWEIndoor.options.wallWidth=e,t.target.value=e,this._map.fire("redraw:all"))}},this)),t=this._getTabContainer(2),t&&(this._map.RSWEIndoor.options.snapOptions.displaySnapGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.options.snapGrid.options.hidden===!0?e.innerHTML='<label><input type="checkbox" name="displaySnapGrid" value="1" /> Display Snap Grid</label>':e.innerHTML='<label><input type="checkbox" checked name="displaySnapGrid" value="1" /> Display Snap Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.options.snapGrid.show(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!0):(this._map.options.snapGrid.hide(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!1)},this)),this._map.RSWEIndoor.options.snapOptions.gridStep!==i&&(e=L.DomUtil.create("div","snap-grid-step-options-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name=snapgridstep" />Snap Grid Step (meters)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.snapOptions.gridStep),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=this.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.snapOptions.gridStep:(e=+e,this._map.RSWEIndoor.options.snapOptions.gridStep=e,t.target.value=e,this._map.options.snapGrid.options.interval=e,this._map.RSWEIndoor.SetSnapOptions(),this._map.options.snapGrid.redraw(),this._map.RSWEIndoor.options.controlLayer.eachLayer(function(t){t.snapediting!==i&&t.snapediting._snapper!==i&&(t.snapediting._snapper.options.gridStep=e)}))}},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)))}}),L.control.dialog.options=function(t){return new L.Control.Dialog.Options(t)},L.Control.Dialog.Load=L.Control.Dialog.extend({options:{size:[300,150],minSize:[300,150],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},msgDiv:{},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this.msgDiv.innerHTML="",this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Load Drawing From File</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content" ><h3>Load Drawing From File</h3></div></div>',"</div>","</div>",""],_dlgCreateControls:function(){var e,i;e=this._getTabContainer(0),e&&(i=L.DomUtil.create("div","save-file-name"),e.appendChild(i),t.File&&t.FileReader&&t.FileList&&t.Blob?(i.innerHTML=["<div></div>",'<input type="file" name="file" />','<output id="list"></output>'].join(""),this.msgDiv=i.getElementsByTagName("DIV")[0],this.InputName=i.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(this.InputName,"change",function(t){this.handleFileSelect(t)},this)):i.innerHTML=["<div>Sorry. The File APIs are not fully supported in this browser.</div>"].join(""));
},handleFileSelect:function(t){var e=t.target.files;if(!e.length)return void(this.msgDiv.innerHTML="Please select a file!");var i=new FileReader;i.thisDlg=this,i.onloadend=function(t){if(t.target.readyState===FileReader.DONE){t.target.thisDlg.InputName.value="";var e=t.target.thisDlg._map.RSWEIndoor.loadData(L.Util.base64Utf8Decode(t.target.result));if(!e)return void(t.target.thisDlg.msgDiv.innerHTML="ERROR loading data!  Please check file contents.");t.target.thisDlg.close()}};var o=e[0].slice(0,e[0].size);i.readAsBinaryString(o)}}),L.control.dialog.load=function(t){return new L.Control.Dialog.Load(t)},L.Control.Dialog.Save=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Save Drawing As</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Drawing As</h3></div></div>',"</div>","</div>",""],saveAsText:function(){var t=this.options.saveALink,e="RSWE.json";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this._map.RSWEIndoor.getData();t.href="data:text/plain;base64,"+L.Util.base64Encode(i),t.click(),this.close()},_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(e=L.DomUtil.create("div","save-file-name"),t.appendChild(e),e.innerHTML=['<a href="" download="" style="display:none;"></a>','<label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>','&nbsp;<input type="button" value="Save drawing to file"/>','<br><br><i>Your drawing will be saved into system "Download" folder.</i>'].join(""),this.options.saveALink=e.firstChild,this.options.InputName=e.getElementsByTagName("INPUT")[0],this.options.InputButton=e.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsText()},this))}}),L.control.dialog.save=function(t){return new L.Control.Dialog.Save(t)},L.Control.Dialog.SaveSVG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Save Data As SVG</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As SVG</h3></div></div>',"</div>","</div>",""],saveAsSVG:function(){var t=this.options.saveALink,e="RSWE.svg";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this._map.RSWEIndoor.getSVGData();t.href="data:image/svg+xml;base64,"+L.Util.base64Encode(i),t.click(),this.close()},_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(e=L.DomUtil.create("div","save-file-name"),t.appendChild(e),e.innerHTML=['<a href="" download="" style="display:none;"></a>','<label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>','&nbsp;<input type="button" value="Save data to SVG file"/>','<br><br><i>Your drawing will be saved into system "Download" folder.</i>'].join(""),this.options.saveALink=e.firstChild,this.options.InputName=e.getElementsByTagName("INPUT")[0],this.options.InputButton=e.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsSVG()},this))}}),L.control.dialog.save=function(t){return new L.Control.Dialog.Save(t)},L.Control.Dialog.SavePNG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Save Data As PNG</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save SVG Data As</h3></div></div>',"</div>","</div>",""],saveAsPNG:function(){var t=this.options.saveALink,e="RSWE.png";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this;this._map.RSWEIndoor.getPNGData(function(e){t.href="data:image/png;base64,"+e,t.click(),i.close()})},_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(e=L.DomUtil.create("div","save-file-name"),t.appendChild(e),e.innerHTML=['<a href="" download="" style="display:none;"></a>','<label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>','&nbsp;<input type="button" value="Save data to PNG file"/>','<br><br><i>Your drawing will be saved into system "Download" folder.</i>'].join(""),this.options.saveALink=e.firstChild,this.options.InputName=e.getElementsByTagName("INPUT")[0],this.options.InputButton=e.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsPNG()},this))}}),L.control.dialog.save=function(t){return new L.Control.Dialog.Save(t)},L.Control.Dialog.SaveJPG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var o=this._getTab(i),n=this._getTabTitle(i);t!==i?(o.setAttribute("class","dialog-tab"),n.setAttribute("class","dialog-tab-title")):(o.setAttribute("class","dialog-tab selected"),n.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])],this.options.anchor=[Math.floor(.5*(e.x-this.options.size[0])),Math.floor(.5*(e.y-this.options.size[1]))],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var o=function(t){return function(){this._selectTab(t)}},n=this._getTabCount(),a=0;n>a;a++)L.DomEvent.addListener(this._getTabTitle(a),"click",o(a),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Save Data As JPG</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As JPG</h3></div></div>',"</div>","</div>",""],saveAsJPG:function(){var t=this.options.saveALink,e="RSWE.jpg";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this;this._map.RSWEIndoor.getJPGData(function(e){t.href="data:image/jpeg;base64,"+e,t.click(),i.close()})},_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(e=L.DomUtil.create("div","save-file-name"),t.appendChild(e),e.innerHTML=['<a href="" download="" style="display:none;"></a>','<label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>','&nbsp;<input type="button" value="Save data to JPG file"/>','<br><br><i>Your drawing will be saved into system "Download" folder.</i>'].join(""),this.options.saveALink=e.firstChild,this.options.InputName=e.getElementsByTagName("INPUT")[0],this.options.InputButton=e.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsJPG()},this))}}),L.control.dialog.save=function(t){return new L.Control.Dialog.Save(t)}}(window,document);